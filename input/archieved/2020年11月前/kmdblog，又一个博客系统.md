title: kmdblog，又一个博客系统
author: 归零幻想
publishDate: 2020-08-21
editDate: 2020-08-21
tags: [博客, Kotlin]

<!--config-->

博客系统至今为止我做过3个版本了，毕竟只要写出CRUD就可以厚着脸皮说自己是个博客，是新手练手的良好选择。当前这个版本是Kotlin练手项目，与之前不同的是，当前版本是一个生成静态网页的系统。类似hexo，在本地编辑好`md`文件，再执行程序生成`html`，发布静态网页即可。

## 背景

1. 主要是练手的考虑。今年暑假在字节跳动实习，在安卓这边，第一次接触`Kotlin`，于是想到写点什么练手。
2. 服务器要花钱的，学生优惠一个月￥10左右，而我博客使用频率较低，不想出这钱了……

<!--summary-->

## 设计

### 配置保存

我们要保存的配置，不只包括站点共有的配置，也包括文章的一些信息。包括文章标题、作者、简介、创建修改时间等。既然我们用`markdown`编辑文章，那么最好配置也是文本格式，这样我们可以不离开编辑器就把事情都做了。最终选定xml格式保存配置。

读写`xml`选择`dom4j`。

### markdown渲染

文章渲染有两种选择，即编辑时渲染和浏览时渲染。一般我们都是编辑时渲染，因为我们不差这点存储空间，浏览时渲染会导致低端设备（如手机）卡顿，且对SEO不友好。

最终决定用`flexmark-java`来进行渲染。整个`flexmark-java`实在有点大，只引入了一部分。

### html渲染

因为仍然没有学前端相关的东西，前端还是打算用之前`bootstrap`写的那个渣渣界面。之前界面是`thymeleaf`的模板，现在不用`spring`了，甚至不是web项目了，还能用吗？

仍然可以，虽然官网的文档没有写的很清楚。大概是一般真没有这种需求吧，官网的最简单demo都是个web项目。

其实直接调用它渲染也挺简单的，只要准备个`TemplateEngine`和一个`ITemplateResolver`就可以了。然后我发现有个`FileTemplateResolver`可以直接映射到文件。

不过缺点是不支持模板中类似`th:href=@{test}`的东西了。问题也不大。

### 『依赖』关系管理

如何确定修改文章后，哪些文件该被重新渲染呢？这里我参考编译器的处理，把源文件作为『依赖』，当md或者xml文件修改日期晚于html时重新生成。

另外主页要特殊处理，始终构建。

## 引用的第三方组件

见[本站about](/about.html)。

## 开源

代码托管在[github](https://github.com/zerofancy/kmdblog)。
