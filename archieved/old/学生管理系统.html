<!DOCTYPE HTML>
<html xmlns="http://www.w3.org/1999/xhtml" lang="zh-Hans">

<head>
    
    
    <title>学生管理系统--归零幻想的博客</title>
    <meta charset="UTF-8">
    <!--移动设备不缩放-->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <link rel="alternate" type="application/rss+xml" title="归零幻想" href="https://ntutn.top/rss.xml" />
    <!--github的markdown样式-->
    <link rel="stylesheet" href="/res/css/github-markdown.css">
    <!--一个基于bootstrap的样式-->
    <link rel="stylesheet" href="/res/css/main.css">

    <script src="/res/js/jquery.min.js"></script>
    <script src="/res/js/popper.min.js"></script>
    <script src="/res/js/bootstrap.min.js"></script>

    <style>
        /*图片缩放*/
        .imageWrapper {
            max-width: 500px;
            max-height: 100%;
            display: block;
            margin: 0 auto;
        }

        /*背景图片*/
        body {
            background: url(https://unsplash.it/1600/900?random);
            background-attachment: fixed;
            background-position: bottom center;
            background-size: cover;
        }
    </style>
    <script src="/res/js/zoomify.min.js"></script>
    <link href="/res/css/zoomify.min.css" rel="stylesheet">

    <script>
        $(document).ready(function () {
            $(".markdown-body img").each(function () {
                divImageWrapper = $(this).after("<div class='imageWrapper'></div>")
                $(this).appendTo($(this).next())
            })
            $(".markdown-body img").zoomify()
        })
    </script>
</head>

<body>
    <div class="container">
        <nav id="nav" class="navbar navbar-expand-lg navbar-light bg-light">
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarTogglerDemo03"
                aria-controls="navbarTogglerDemo03" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <a class="navbar-brand" href="/"><img src="/res/logo.png" width="70" height="40"
                    class="d-inline-block align-top" alt="">
                <span>归零幻想的博客</span></a>

            <div class="collapse navbar-collapse" id="navbarTogglerDemo03">
                <ul class="navbar-nav mr-auto mt-2 mt-lg-0">
                    <li id="n_home" class="nav-item">
                        <a class="nav-link" href="/">主页</a>
                    </li>
                    <!-- <li id="n_tags" class="nav-item">
                        <a class="nav-link" href="/tags">标签</a>
                    </li> -->
                    <li id="n_about" class="nav-item">
                        <a class="nav-link" href="https://channel.ntutn.workers.dev/">频道</a>
                    </li>
                    <li id="n_about" class="nav-item">
                        <a class="nav-link" href="/friends.html">友链</a>
                    </li>
                    <li id="n_about" class="nav-item">
                        <a class="nav-link" href="/about.html">关于</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/rss.xml">RSS</a>
                    </li>
                </ul>
            </div>
        </nav>
        <nav class="mt-3" aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/">Home</a></li>

                <li class="breadcrumb-item active" aria-current="page">学生管理系统</li>
            </ol>
        </nav>
        <div class="card mt-3 mb-3">
            <div class="card-body markdown-body">
                <h1 class="card-title text-center realtitle">学生管理系统</h1>
                <!--TODO 时间-->
                <h6 class="card-subtitle mb-2 text-muted text-center">
                    发布时间：<span>2019-04-13</span>&nbsp;
                    修改时间：<span>2019-04-13</span>&nbsp;
                    作者：<span>归零幻想</span>
                </h6>
                <br>
                <div class="card-text"><blockquote>
<p>翻出了以前C语言C实验的大作业，当时搞了好多奇技淫巧，最终拿到99分。</p>
</blockquote>
<h2 id="介绍">介绍</h2>
<p>学生成绩管理系统v6.0是由软件工程1702刘海鑫设计的一款用于学生成绩管理的软件。</p>
<h2 id="文件列表">文件列表</h2>
<ul>
<li>Stuv6.0.exe	主体程序，用于实现整体功能。</li>
<li>main.dat	程序的数据文件，用于存储学生信息。</li>
<li>goodbye.bmp	程序退出时加载的图片。</li>
<li>desktop.ini	修改程序所在文件夹的图标。</li>
<li>consoletest.exe	编译的au3程序，用于辅助输入中文。</li>
</ul>
<p>代码：</p>
<pre><code class="language-autoit">$re=InputBox(&quot;Input&quot;,&quot;You can input your massage now.(支持中文)&quot;)
ConsoleWrite($re)
</code></pre>
<ul>
<li>code.dat	密码存储文件。该文件存储的是xor算法加密的账号密码。</li>
<li>black.bmp	一张纯黑的图片，用于清除控制台加载图片的痕迹。2018年1月20日使用了image /d清除图片，本文件不再使用。</li>
<li>background.bmp	程序启动时加载的图片。</li>
<li>about.rtf	程序的说明文档。</li>
<li>scaned.txt	存储用户输入的临时文件，一般会自动清除。</li>
<li>subjects.dat	存储科目的名称，每行一个，最多允许50个，可用记事本直接打开编辑。</li>
<li>image.exe	外部程序，用于加载图片。</li>
</ul>
<h2 id="使用说明">使用说明</h2>
<p>双击<code>stuv6.0.exe</code>，程序启动。</p>
<p>待启动图片显示过后，出现密码输入框，回车确认输入。</p>
<p>默认账号：<code>admin</code></p>
<p>默认密码：<code>admin888</code></p>
<p>输入密码时如果输入~符号，将弹出一个信息框提示输入。这是为了便于输入中文和特殊符号。</p>
<p>本程序的密码存储是xor运算的结果，仅用于比对密码是否正确。</p>
<p>接下来进入主菜单。菜单使用黄色为底色，红色标定选中项。你可以按上下键选择，或直接按项目对应数字，回车确认。</p>
<h2 id="开发日志">开发日志</h2>
<ul>
<li>
<p>2018年3月10日，加入了控制台窗口大小控制的代码。</p>
</li>
<li>
<p>修改了exe文件的图标。</p>
</li>
<li>
<p>改用外部程序image.exe加载图片，并修改gotoxy函数的使用，成功使代码兼容了gun gcc系列编译器。</p>
</li>
<li>
<p>测试WIN7运行效果，图片加载错位，无法全屏，其他功能不受影响。</p>
</li>
<li>
<p>在科目分析功能加入分层成绩展示，至此，程序主体开发完毕。</p>
</li>
<li>
<p>加入查找功能，查找方式为遍历，依据为id或姓名。
同理，加入按id排序、按姓名的字典顺序排序。
数据排序功能，选择后弹出二级菜单，进行升序排序或降序排序。
排序的结果不会保存。
排序后将自动展示排序结果。</p>
</li>
<li>
<p>加入了科目分析，统计各科总分平均分。</p>
</li>
<li>
<p>删除学生功能准备完成。</p>
</li>
<li>
<p>将修改密码部分移出主函数，便于管理。</p>
</li>
<li>
<p>学生信息展示准备完成。</p>
</li>
<li>
<p>添加学生功能准备完成，界面比较简陋。</p>
</li>
<li>
<p>发现有点控制台用BitBlt画的图不会自动清除，于是找了一张全黑的图片将其覆盖。</p>
</li>
<li>
<p>发现在WIN7等系统控制台加载图片会出现错位，暂时不打算解决。</p>
</li>
<li>
<p>开始准备程序主体功能。</p>
</li>
<li>
<p>记事本太单调，决定将about改为写字板，内容为本文件。</p>
</li>
<li>
<p>发现了atexit函数，于是顺理成章地加入了程序退出图。</p>
</li>
<li>
<p>找到一个取巧的方法。控制台也是一个窗口，获取了他的句柄就可以在上面用BitBlt直接画图了吧。</p>
</li>
<li>
<p>决定加入加载启动退出图片功能。可是Windows环境下C语言直接调用GDI常常导致系统蓝屏。虽然直接用其他语言就可以轻松写出，但总是有点不甘心。</p>
</li>
<li>
<p>加入了about，system(&quot;notepad.exe about.txt&quot;)实现。</p>
</li>
<li>
<p>加入了密码修改功能。</p>
</li>
<li>
<p>发现并修正了“窗口”覆盖时的一个BUG。</p>
</li>
<li>
<p>成功实现菜单功能！上下键控制菜单移动，回车选择目标。亦可直接按选项对应数字移动菜单项。函数原型：int showMenu(char txt[][50],int n,int selected,int X,int Y)
txt是各菜单的文本。
n是菜单项总数目。
selected为当前选中项。
X,Y为菜单加载的坐标。
函数返回值为用户最终选定项。</p>
</li>
<li>
<p>发现getch对中文兼容不好。为了方便输入中文密码，用AU3写了控制台程序：</p>
</li>
<li>
<p>在getch检测到用户输入~后即打开该程序输入数据。</p>
</li>
<li>
<p>制作了密码登录界面，用户名用fgets扫描，password用getch检测。getch检测到后输出*。</p>
</li>
<li>
<p>调用前面的函数实现了伪信息框（图左），虽然和系统的信息框（图右）没得比，但在控制台下做出这个水平我还是知足了。</p>
</li>
<li>
<p>UE的控制台与程序兼容性实在不行，改用code blocks作为IDE，编译器使用gcc for windows。</p>
</li>
<li>
<p>通过gotoxy和严格的坐标计算实现了绘制伪窗口功能。</p>
</li>
<li>
<p>发现了函数gotoxy(x,y)，可以控制光标输出位置，但好像移植性不好，比如GUN系列编译器就是另一个函数。决定还是使用。</p>
</li>
<li>
<p>最终暂时选定XOR算法，代码：</p>
</li>
<li>
<p>准备用户登录验证方案，由经验打算采用XOR算法或MD5算法。</p>
</li>
<li>
<p>找到了合理的颜色控制方案，但似乎并不是所有控制台都能使用（UltraEdit DOS Command就不能用），不过暂时就这样了。</p>
</li>
<li>
<p>决定将界面制作得精美一些。查找资料。找到DOS命令color可以改控制台颜色方案，但只能同时更改整个控制台的颜色，怎么看都不舒服，放弃。</p>
</li>
<li>
<p>找到DOS指令title可以直接修改控制台标题。控制台标题改为“学生成绩管理系统V6.0”。</p>
</li>
<li>
<p>选定课题为学生成绩管理系统，总体难度不大，毕竟书上范例改一改就是标准答案了。但我决定还是挑战一下。</p>
</li>
</ul>
<p><img src="/res/img/stu1.png" alt="" /></p>
<p><img src="/res/img/stu2.png" alt="" /></p>
<p><img src="/res/img/stu3.png" alt="" /></p>
<pre><code class="language-c">#include &quot;stdio.h&quot;
#include &quot;stdlib.h&quot;
#include &quot;string.h&quot;
#include &lt;windows.h&gt;
//#include &lt;conio.h&gt;
#include &quot;math.h&quot;
void miniMessage(char*msg);
void showExitPic();
/*
typedef HWND (WINAPI *PROCGETCONSOLEWINDOW)();//图片加载
PROCGETCONSOLEWINDOW GetConsoleWindow;
*/
void PrintChar(char *ch,UINT count,UINT x,UINT y)  //在坐标(x,y)处输出字符串ch,ch里有count个字符
{
    HANDLE h=GetStdHandle(STD_OUTPUT_HANDLE);
    COORD pos;
    ULONG unuse;
    pos.X=x;
    pos.Y=y;
    CONSOLE_SCREEN_BUFFER_INFO bInfo; // 窗口缓冲区信息
    GetConsoleScreenBufferInfo(h, &amp;bInfo );
    WriteConsoleOutputCharacterA(h,ch,count,pos,&amp;unuse);
}

void color(short x) //自定义函根据参数改变颜色
{
    if(x&gt;=0 &amp;&amp; x&lt;=15)//参数在0-15的范围颜色
        SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), x);    //只有一个参数，改变字体颜色
    else//默认的颜色白色
        SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE), 7);

    /*
    颜色函数SetConsoleTextAttribute(GetStdHandle(STD_OUTPUT_HANDLE),前景色 | 背景色 | 前景加强 | 背景加强);
        前景色：数字0-15 或 FOREGROUND_XXX 表示  （其中XXX可用BLUE、RED、GREEN表示）
        前景加强：数字8 或 FOREGROUND_INTENSITY 表示
        背景色：数字16 32 64 或 BACKGROUND_XXX 三种颜色表示
        背景加强： 数字128 或 BACKGROUND_INTENSITY 表示
    主要应用：改变指定区域字体与背景的颜色
    前景颜色对应值：
    　　0=黑色                8=灰色　　
      　1=蓝色                9=淡蓝色        十六进制        　　
    　　2=绿色                10=淡绿色       0xa        　　
    　　3=湖蓝色              11=淡浅绿色     0xb　
    　　4=红色                12=淡红色       0xc　　
    　　5=紫色                13=淡紫色       0xd        　　
    　　6=黄色                14=淡黄色       0xe        　　
    　　7=白色                15=亮白色       0xf
    　　也可以把这些值设置成常量。
    */
}

void gotoxy(unsigned char x,unsigned char y)
{
    //COORD是Windows API中定义的一种结构，表示一个字符在控制台屏幕上的坐标
    COORD cor;

    //句柄
    HANDLE hout;

    //设定我们要定位到的坐标
    cor.X = x;
    cor.Y = y;

    //GetStdHandle函数获取一个指向特定标准设备的句柄，包括标准输入，标准输出和标准错误。
    //STD_OUTPUT_HANDLE正是代表标准输出（也就是显示屏）的宏
    hout = GetStdHandle(STD_OUTPUT_HANDLE);

    //SetConsoleCursorPosition函数用于设置控制台光标的位置
    SetConsoleCursorPosition(hout, cor);
}

typedef struct
{
    char name[25];
    char sex;
    int age;
    int id;
    int subjects[50];
    int sum;
    int avg;
} student;

char sub_name[50][25];
student stu_dat[10000];
int dat_count;
int sub_count;

int Login(char*c1,char*c2)
{
    FILE*fp;
    char*p1;
    char*p3;
    char*p2;
    int tmp;
    fp=fopen(&quot;code.dat&quot;,&quot;r&quot;);
    p1=c1;
    p3=c2;
    if(strlen(c1)&gt;strlen(c2))
    {
        p2=p1;
        p1=p3;
        p3=p2;
    }
    for (; *p3!='\0'; )
    {
        if(*p1=='\0')
        {
            p1=c1;
        }
        tmp=fgetc(fp);
        if(((*p1)^(*p3))!=tmp)
        {
            return 0;
        }
        p1++;
        p3++;
    }
    if(strlen(c1)&lt;2||strlen(c2)&lt;6)
    {
        return 0;
    }
    return 1;
    fclose(fp);
}

void savePwd(char*c1,char*c2)
{
    FILE*fp;
    fp=fopen(&quot;code.dat&quot;,&quot;w&quot;);
    char*p1=c1;
    char*p2=c2;
    char*p3;
    if(strlen(c1)&gt;strlen(c2))
    {
        p3=p1;
        p1=p2;
        p2=p3;
    }

    for (; *p2!='\0'; )
    {
        if(*p1=='\0')
        {
            p1=c1;
        }
        fputc((*p1)^(*p2),fp);
        p1++;
        p2++;
    }
    fclose(fp);
}

void dat_add(student*s1)
{
    FILE*fp;
    s1-&gt;sum=0;
    for (int i=0; i&lt;sub_count; i++)
    {
        s1-&gt;sum+=s1-&gt;subjects[i];
    }
    s1-&gt;avg=s1-&gt;sum/=sub_count;
    fp=fopen(&quot;main.dat&quot;,&quot;ab&quot;);
    if(fp==NULL)
    {
        fp=fopen(&quot;main.dat&quot;,&quot;wb&quot;);
    }
    fwrite(s1,sizeof(student),1,fp);
    fclose(fp);
}

void sub_load()
{
    FILE*fp;
    fp=fopen(&quot;subjects.dat&quot;,&quot;r&quot;);
    sub_count=0;
    for (int i=0; i&lt;50; i++)
    {
        fgets(sub_name[i],sizeof(sub_name),fp);
        sub_name[i][strlen(sub_name[i])-1]='\0';
        if(strlen(sub_name[i])&gt;0)
        {
            sub_count++;
        }
    }
    fclose(fp);
}

void sub_print()
{
    printf(&quot;学号\t姓名\t性别\t年龄\t&quot;);
    for (int i=0; i&lt;50; i++)
    {
        if(strlen(sub_name[i])==0)
        {
            break;
        }
        printf(&quot;%s\t&quot;,sub_name[i]);
    }
    printf(&quot;总分\t平均分\t排名\t&quot;);
    putchar('\n');
}

int dat_load()
{
    FILE*fp;
    int i;
    fp=fopen(&quot;main.dat&quot;,&quot;rb&quot;);
    if(fp==NULL)
    {
        puts(&quot;main.dat is lost!&quot;);
        exit(1);
    }
    for (i=0; !feof(fp) ; i++)
    {
        fread(&amp;stu_dat[i],sizeof(student),1,fp);
    }
    fclose(fp);
    return i-1;
}

void dat_show (student s)
{
    printf(&quot;%d\t%s\t%c\t%d\t&quot;,s.id,s.name,s.sex,s.age);
    for (int i=0; i&lt;sub_count; i++)
    {
        printf(&quot;%d\t&quot;,s.subjects[i]);
    }
    printf(&quot;%d\t%d\t&quot;,s.sum,s.avg);
}

void showMiniWindow(char*title,int X,int Y,int height,int width)
{
    for(int i=0; i&lt;width; i++)
    {
        for(int i2=0; i2&lt;height; i2++)
        {
            gotoxy(X+i,Y+i2);
            putchar(' ');
        }
    }
    color(3);
    gotoxy(X,Y);
    putchar('X');
    gotoxy(X+width-1,Y);
    putchar('X');
    gotoxy(X,Y+height-1);
    putchar('X');
    gotoxy(X+width-1,Y+height-1);
    putchar('X');
    color(5);
    for (int i=2; i&lt;width; i++)
    {
        gotoxy(X+i-1,Y);
        putchar('-');
        gotoxy(X+i-1,Y+height-1);
        putchar('-');
    }
    color(9);
    for (int i=2; i&lt;height; i++)
    {
        gotoxy(X,Y+i-1);
        putchar('|');
        gotoxy(X+width-1,Y+i-1);
        putchar('|');
        PrintChar(&quot;|&quot;,1,X+width-1,Y+i-1);
    }
    color(12);
    gotoxy(X+width/2-strlen(title)/2,Y);
    printf(&quot;%s&quot;,title);
    color(16);
    gotoxy(X+1,Y+1);
}

void miniLogin ()
{
    char c1[25],c2[25];
    char ch_tmp;
    char*p=c2;
    FILE*fp;
    showMiniWindow(&quot;login&quot;,6,5,4,32);
    puts(&quot;User     ________________&quot;);
    gotoxy(7,7);
    puts(&quot;password ________________&quot;);
    gotoxy(16,6);
    fgets(c1,sizeof(c1),stdin);
    c1[strlen(c1)-1]='\0';
    gotoxy(16,7);
    while(1)
    {
        ch_tmp=getch();
        if(ch_tmp==13)
        {
            *p='\0';
            break;
        }
        else if(ch_tmp=='~')
        {
            system(&quot;consoletest.exe&gt;scaned.txt&quot;);
            fp=fopen(&quot;scaned.txt&quot;,&quot;r&quot;);
            fgets(c2,sizeof(c2),fp);
            fclose(fp);
            system(&quot;del scaned.txt&quot;);
            break;
        }
        else
        {
            *p=ch_tmp;
            p++;
            putchar('*');
        }
    }
    if(Login(c1,c2))
    {
        miniMessage(&quot;登录成功，欢迎您的使用！&quot;);
    }
    else
    {
        miniMessage(&quot;用户名或密码错误！&quot;);
        Sleep(1000);
        showExitPic();
        exit(1);
    }
    Sleep(1000);
}

void miniMessage(char*msg)
{
    int n=strlen(msg);
    int width=(int)sqrt(n)+10;
    int height=n/(width-2)+4;
    int X=5;
    int Y=7;
    showMiniWindow(&quot;Message&quot;,X,Y,height,width);
    X++;
    Y++;
    for (int i=0; i&lt;n; i++)
    {
        putchar(msg[i]);
        if(i%(width-2)==0)
        {
            Y++;
            gotoxy(X,Y);
        }
    }
}

int showMenu(char txt[][50],int n,int selected,int X,int Y)
{
    int maxwidth=0;
    int tmp_width;
    char tmp_press;
    for(int i=0; i&lt;n; i++)
    {
        tmp_width=strlen(txt[i]);
        if(tmp_width&gt;maxwidth)
        {
            maxwidth=tmp_width;
        }
    }
    showMiniWindow(&quot;MENU&quot;,X,Y,n+2,maxwidth+2);
    for(int i=0; i&lt;n; i++)
    {
        if(i==selected)
        {
            color(4);
        }
        else
        {
            color(6);
        }
        for(int i2=0; txt[i][i2]!='\0'; i2++)
        {
            gotoxy(X+i2+1,Y+i+1);
            putchar(txt[i][i2]);
        }
    }
    color(16);
    tmp_press=getch();
    if(tmp_press==13)
    {
        return selected;
    }
    else if(tmp_press==72)
    {
        if(selected&gt;0)
        {
            selected--;
        }
        else
        {
            putchar('\a');
        }
    }
    else if(tmp_press==80)
    {
        if(selected&lt;n-1)
        {
            selected++;
        }
        else
        {
            putchar('\a');
        }
    }
    else if(tmp_press-'0'&gt;=0&amp;&amp;tmp_press-'0'&lt;n)
    {
        selected=tmp_press-'0';
    }
    return showMenu(txt,n,selected,X,Y);
}
/*
void picLoad(char*path)
{
    HMODULE hKernel32 = GetModuleHandle(&quot;kernel32&quot;);
    GetConsoleWindow= (PROCGETCONSOLEWINDOW)GetProcAddress(hKernel32,&quot;GetConsoleWindow&quot;);
    HWND cmd=GetConsoleWindow();
    HDC dc = GetDC(cmd);
    HBITMAP hBitmap;
    hBitmap=(HBITMAP)LoadImage            (NULL,path,IMAGE_BITMAP,0,0,LR_LOADFROMFILE|LR_CREATEDIBSECTION);
    HDC cmdmem = CreateCompatibleDC(dc);
    SelectObject(cmdmem, hBitmap);
    BitBlt(dc, 0, 0, 1300, 700, cmdmem, 0, 0, SRCCOPY);
    Sleep(3000);
    return ;
}*/
/*
void loadBlack()
{
    HMODULE hKernel32 = GetModuleHandle(&quot;kernel32&quot;);
    GetConsoleWindow= (PROCGETCONSOLEWINDOW)GetProcAddress(hKernel32,&quot;GetConsoleWindow&quot;);
    HWND cmd=GetConsoleWindow();
    HDC dc = GetDC(cmd);
    HBITMAP hBitmap;
    hBitmap=(HBITMAP)LoadImage            (NULL,&quot;black.bmp&quot;,IMAGE_BITMAP,0,0,LR_LOADFROMFILE|LR_CREATEDIBSECTION);
    HDC cmdmem = CreateCompatibleDC(dc);
    SelectObject(cmdmem, hBitmap);
    BitBlt(dc, 0, 0, 1300, 700, cmdmem, 0, 0, SRCCOPY);
    return ;
}
*/
void showExitPic()
{
    system(&quot;image goodbye.bmp 0 0&quot;);
    Sleep(3000);
    //picLoad(&quot;goodbye.bmp&quot;);
}

void add_stu()
{
    char tmp_sex[10];
    student tmp;
    system(&quot;cls&quot;);
    printf(&quot;Please input the id number of the new student.\n&quot;);
    scanf(&quot;%d&quot;,&amp;tmp.id);
    printf(&quot;Please input the name of the student.\n&quot;);
    scanf(&quot;%s&quot;,tmp.name);
    printf(&quot;Please input the sex of the student.(F for Female,M for Male.)\n&quot;);
    scanf(&quot;%s&quot;,tmp_sex);
    if(strcmp(tmp_sex,&quot;F&quot;)==0)
    {
        tmp.sex='F';
    }
    else
    {
        tmp.sex='M';
    }
    printf(&quot;Please input the age of the student.\n&quot;);
    scanf(&quot;%d&quot;,&amp;tmp.age);
    for(int i=0; i&lt;sub_count; i++)
    {
        printf(&quot;Please input %s's %s score.\n&quot;,tmp.name,sub_name[i]);
        scanf(&quot;%d&quot;,&amp;tmp.subjects[i]);
    }
    dat_add(&amp;tmp);
    dat_count=dat_load();
    printf(&quot;Data added successfully!\n&quot;);
    Sleep(3000);
}

void showalldata()
{
    system(&quot;cls&quot;);
    sub_print();
    for(int i=0; i&lt;dat_count; i++)
    {
        printf(&quot;%d\t%s\t%c\t%d\t&quot;,stu_dat[i].id,stu_dat[i].name,stu_dat[i].sex,stu_dat[i].age);
        for(int i2=0; i2&lt;sub_count; i2++)
        {
            printf(&quot;%d\t&quot;,stu_dat[i].subjects[i2]);
        }
        printf(&quot;%d\t%d\t%d\t\n&quot;,stu_dat[i].sum,stu_dat[i].avg,i+1);
    }

    system(&quot;pause&quot;);
}

void ed_password()
{
    char us_name[50];
    char us_pwd[50];
    char us_pwd2[50];
    char us_pwd3[50];
    char*p;
    FILE*fp;

    system(&quot;cls&quot;);
    showMiniWindow(&quot;修改密码&quot;,5,7,6,36);
    puts(&quot;UserName&quot;);
    gotoxy(6,9);
    puts(&quot;PassWord&quot;);
    gotoxy(6,10);
    puts(&quot;NewPassWord&quot;);
    gotoxy(6,11);
    puts(&quot;Again&quot;);
    gotoxy(18,8);
    scanf(&quot;%s&quot;,us_name);
    gotoxy(18,9);
    p=us_pwd;
    while(1)
    {
        *p=getch();
        if(*p==13)
        {
            p--;
            break;
        }
        else if(*p=='~')
        {
            system(&quot;consoletest.exe&gt;scaned.txt&quot;);
            fp=fopen(&quot;scaned.txt&quot;,&quot;r&quot;);
            fgets(us_pwd,sizeof(us_pwd),fp);
            fclose(fp);
            system(&quot;del scaned.txt&quot;);
            break;
        }
        else
        {
            putchar('*');
            p++;
        }
    }
    gotoxy(18,10);
    p=us_pwd2;
    while(1)
    {
        *p=getch();
        if(*p==13)
        {
            p--;
            break;
        }
        else if(*p=='~')
        {
            system(&quot;consoletest.exe&gt;scaned.txt&quot;);
            fp=fopen(&quot;scaned.txt&quot;,&quot;r&quot;);
            fgets(us_pwd2,sizeof(us_pwd2),fp);
            fclose(fp);
            system(&quot;del scaned.txt&quot;);
            break;
        }
        else
        {
            putchar('*');
            p++;
        }
    }
    gotoxy(18,11);
    p=us_pwd3;
    while(1)
    {
        *p=getch();
        if(*p==13)
        {
            p--;
            break;
        }
        else if(*p=='~')
        {
            system(&quot;consoletest.exe&gt;scaned.txt&quot;);
            fp=fopen(&quot;scaned.txt&quot;,&quot;r&quot;);
            fgets(us_pwd3,sizeof(us_pwd3),fp);
            fclose(fp);
            system(&quot;del scaned.txt&quot;);
            break;
        }
        else
        {
            putchar('*');
            p++;
        }
    }
    if(Login(us_name,us_pwd)&amp;&amp;strcmp(us_pwd2,us_pwd3)==0)
    {
        savePwd(us_name,us_pwd2);
        miniMessage(&quot;Password modification success&quot;);
    }
    else
    {
        miniMessage(&quot;Password modification failed,please check you input.&quot;);
    }
    Sleep(3000);
    system(&quot;cls&quot;);
}

void del_dat()
{
    int tmp_number;
    char str_cmd[255];
    system(&quot;cls&quot;);
    printf(&quot;Please input the id of the data.\n&quot;);
    printf(&quot;System will delete the first data founded.\n&quot;);
    scanf(&quot;%d&quot;,&amp;tmp_number);
    for(int i=0; i&lt;dat_count; i++)
    {
        if(stu_dat[i].id==tmp_number)
        {
            printf(&quot;Data founded.Are you sure to delete it?(Y/N)\n&quot;);
            scanf(&quot;%s&quot;,str_cmd);
            if(strcmp(str_cmd,&quot;Y&quot;)!=0&amp;&amp;strcmp(str_cmd,&quot;y&quot;)!=0)
            {
                printf(&quot;Command canceled.\n&quot;);
                system(&quot;pause&quot;);
                return;
            }
            stu_dat[i]=stu_dat[dat_count-1];
            dat_count--;
            system(&quot;del main.dat&quot;);
            for(int i2=0; i2&lt;dat_count; i2++)
            {
                dat_add(&amp;stu_dat[i]);
            }
            printf(&quot;Del successfully!\n&quot;);
            system(&quot;pause&quot;);
            return;
        }
    }
    miniMessage(&quot;Cannot found target data!&quot;);
    system(&quot;pause&quot;);
}

void sub_ana()
{
    system(&quot;cls&quot;);
    int tmp_sum[50];
    int tmp_avg[50];
    int tmp_level[50][5];
    for(int i=0; i&lt;50; i++)
    {
        tmp_sum[i]=0;
        tmp_avg[i]=0;
        for(int i2=0; i2&lt;5; i2++)
        {
            tmp_level[i][i2]=0;
        }
    }
    for(int i=0; i&lt;dat_count; i++)
    {
        for(int i2=0; i2&lt;sub_count; i2++)
        {
            tmp_sum[i2]+=stu_dat[i].subjects[i2];
            switch(stu_dat[i].subjects[i2]/10)
            {
            case 10:
            case 9:
                tmp_level[i][0]++;
                break;
            case 8:
                tmp_level[i][1]++;
                break;
            case 7:
                tmp_level[i][2]++;
                break;
            case 6:
                tmp_level[i][3]++;
                break;
            default:
                tmp_level[i][4]++;
            }
        }
    }
    for(int i=0; i&lt;sub_count; i++)
    {
        tmp_avg[i]=tmp_sum[i]/dat_count;
    }
    printf(&quot;科目\t总分\t平均分\t优秀\t良好\t中等\t及格\t不及格\t\n&quot;);
    for(int i=0; i&lt;sub_count; i++)
    {
        printf(&quot;%s\t%d\t%d\t%d\t%d\t%d\t%d\t%d\t\n&quot;,sub_name[i],tmp_sum[i],tmp_avg[i]
               ,tmp_level[i][0],tmp_level[i][1],tmp_level[i][2],tmp_level[i][3]
               ,tmp_level[i][4]);
    }
    system(&quot;pause&quot;);
}

int cmpbysum1(const void *p1,const void *p2)
{
    return ((student*)p1)-&gt;sum-((student*)p2)-&gt;sum;
}

int cmpbysum2(const void *p1,const void *p2)
{
    return ((student*)p2)-&gt;sum-((student*)p1)-&gt;sum;
}

void sortbysum()
{
    //ascending sort升序排序
    //descending sort降序排序
    char mnu[][50]= {&quot;Ascending sort↑&quot;,&quot;Descending sort↓&quot;,&quot;Cancel&quot;};
    int m_resu;
    m_resu=showMenu(mnu,3,0,7,7);
    system(&quot;cls&quot;);
    switch(m_resu)
    {
    case 0:
        qsort(stu_dat,dat_count,sizeof(student),cmpbysum1);
        break;
    case 1:
        qsort(stu_dat,dat_count,sizeof(student),cmpbysum2);
        break;
    default:
        printf(&quot;Command canceled.\n&quot;);
        system(&quot;pause&quot;);
        return;
    }
    printf(&quot;OK.\n&quot;);
    system(&quot;pause&quot;);
    showalldata();
}

int cmpbyid1(const void *p1,const void *p2)
{
    return ((student*)p1)-&gt;id-((student*)p2)-&gt;id;
}

int cmpbyid2(const void *p1,const void *p2)
{
    return ((student*)p2)-&gt;id-((student*)p1)-&gt;id;
}

void sortbyid()
{
    char mnu[][50]= {&quot;Ascending sort↑&quot;,&quot;Descending sort↓&quot;,&quot;Cancel&quot;};
    int m_resu;
    m_resu=showMenu(mnu,3,0,7,7);
    system(&quot;cls&quot;);
    switch(m_resu)
    {
    case 0:
        qsort(stu_dat,dat_count,sizeof(student),cmpbyid1);
        break;
    case 1:
        qsort(stu_dat,dat_count,sizeof(student),cmpbyid2);
        break;
    default:
        printf(&quot;Command canceled.\n&quot;);
        system(&quot;pause&quot;);
        return;
    }
    printf(&quot;OK.\n&quot;);
    system(&quot;pause&quot;);
    showalldata();
}

int cmpbyname(const void *p1,const void *p2)
{
    return strcmp(((student*)p1)-&gt;name,((student*)p2)-&gt;name);
}

void sortbyname()
{
    system(&quot;cls&quot;);
    qsort(stu_dat,dat_count,sizeof(student),cmpbyname);
    printf(&quot;OK.\n&quot;);
    system(&quot;pause&quot;);
    showalldata();
}

void searchbyid()
{
    int tmp_id;
    int founded=0;
    system(&quot;cls&quot;);
    printf(&quot;Please input the id of the student.\n&quot;);
    scanf(&quot;%d&quot;,&amp;tmp_id);
    system(&quot;cls&quot;);
    sub_print();
    for(int i=0; i&lt;dat_count; i++)
    {
        if(stu_dat[i].id==tmp_id)
        {
            founded++;
            printf(&quot;%d\t%s\t%c\t%d\t&quot;,stu_dat[i].id,stu_dat[i].name,stu_dat[i].sex,stu_dat[i].age);
            for(int i2=0; i2&lt;sub_count; i2++)
            {
                printf(&quot;%d\t&quot;,stu_dat[i].subjects[i2]);
            }
            printf(&quot;%d\t%d\t%d\t\n&quot;,stu_dat[i].sum,stu_dat[i].avg,founded);
        }
    }
    if(founded==0)
    {
        system(&quot;cls&quot;);
        printf(&quot;Not founded!\n&quot;);
    }
    system(&quot;pause&quot;);
}

void searchbyname()
{
    char tmp_name[25];
    int founded=0;
    system(&quot;cls&quot;);
    printf(&quot;Please input the name of the student.\n&quot;);
    scanf(&quot;%s&quot;,tmp_name);
    system(&quot;cls&quot;);
    sub_print();
    for(int i=0; i&lt;dat_count; i++)
    {
        if(strcmp(stu_dat[i].name,tmp_name)==0)
        {
            founded++;
            printf(&quot;%d\t%s\t%c\t%d\t&quot;,stu_dat[i].id,stu_dat[i].name,stu_dat[i].sex,stu_dat[i].age);
            for(int i2=0; i2&lt;sub_count; i2++)
            {
                printf(&quot;%d\t&quot;,stu_dat[i].subjects[i2]);
            }
            printf(&quot;%d\t%d\t%d\t\n&quot;,stu_dat[i].sum,stu_dat[i].avg,founded);
        }
    }
    if(founded==0)
    {
        system(&quot;cls&quot;);
        printf(&quot;Not founded!\n&quot;);
    }
    system(&quot;pause&quot;);
}

int main()
{
    atexit(showExitPic);
    int m_resu;
    char mnu[][50]= {&quot;Modify the password&quot;,&quot;Add new data&quot;,&quot;Show all data&quot;,
                     &quot;Del data by id&quot;,&quot;Subject analysis&quot;,&quot;Sort data by sum&quot;,&quot;Sort data by id&quot;
                     ,&quot;Sort in dictionary order by name&quot;,&quot;Search by id&quot;,&quot;Search by name&quot;
                     ,&quot;about&quot;,&quot;exit&quot;
                    };
    system(&quot;title 学生成绩管理系统V6.0&quot;);
    system(&quot;mode con cols=100 lines=30&quot;);
    //picLoad(&quot;background.bmp&quot;);
    //loadBlack();
    system(&quot;image background.bmp 0 0&quot;);
    Sleep(3000);
    system(&quot;image /d&quot;);
    system(&quot;cls&quot;);
    miniLogin();
    system(&quot;cls&quot;);
    sub_load();
    dat_count=dat_load();
beg:
    m_resu=showMenu(mnu,12,0,5,6);
    switch(m_resu)
    {
    case 0:
        ed_password();
        break;
    case 1:
        add_stu();
        break;
    case 2:
        showalldata();
        break;
    case 3:
        del_dat();
        break;
    case 4:
        sub_ana();
        break;
    case 5:
        sortbysum();
        break;
    case 6:
        sortbyid();
        break;
    case 7:
        sortbyname();
        break;
    case 8:
        searchbyid();
        break;
    case 9:
        searchbyname();
        break;
    case 10:
        system(&quot;write about.rtf&quot;);
        break;
    case 11:
        goto end;
    }
    goto beg;
end:
    ;
}

</code></pre>
</div>
            </div>
            <script src="https://utteranc.es/client.js" repo="zerofancy/zerofancy.github.io" issue-term="学生管理系统" theme="github-light" crossorigin="anonymous" async>
                </script>
        </div>
        <!-- 页脚 -->
        <footer class="navbar navbar-light bg-light">
            <p>版权所有：归零幻想 ┊ 备案号：<a href="http://beian.miit.gov.cn/">暂无</a>┊ Powered by：归零幻想</p>
        </footer>
    </div>
</body>

</html>