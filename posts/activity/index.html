<!DOCTYPE html>
<html><head>
<title>android项目开发：Activity</title>
<meta charset="utf-8"/>
<meta content="IE=edge" name="X-UA-Compatible"/>
<meta content="" name="google-site-verification"/>
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"/>
<meta content="telephone=no" name="format-detection"/>
<meta content="Activity" name="description"/>
<meta content="webkit" name="renderer"/>
<meta content="#ffffff" name="theme-color"/>
<meta content="android项目开发：Activity" property="og:title"/>
<meta content="Activity" property="og:description"/>
<meta content="article" property="og:type"/>
<meta content="https://ntutn.top/posts/activity/" property="og:url"/><meta content="posts" property="article:section"/>
<meta content="2020-12-15T03:11:37+08:00" property="article:published_time"/>
<meta content="2020-12-15T03:11:37+08:00" property="article:modified_time"/><meta content="归零幻想" property="og:site_name"/>
<link href="//images.ntutn.top/favicon.ico" rel="icon"/>
<script src="/js/toc.js"></script>
<link href="/vendor/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="/scss/journal.min.c5d92f380bf10f6849c7ac487c7df2b22c081e0851e5339224f1ae29210b20d2.css" integrity="sha256-xdkvOAvxD2hJx6xIfH3ysiwIHghR5TOSJPGuKSELINI=" media="screen" rel="stylesheet"/>
<link href="/scss/dark-mode.min.9f8d8c2df9285089d141edd4a50cb7506c7948e6ab79a29968dced1bd0ab7d22.css" integrity="sha256-n42MLfkoUInRQe3UpQy3UGx5SOareaKZaNztG9CrfSI=" media="screen" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css?family=Material+Icons" rel="stylesheet"/>
<script data-cf-beacon='{"token": 5a03d307f5214109a1e7c8b2cf306a3d' defer="" src="https://static.cloudflareinsights.com/beacon.min.js">
</script>
<style>
    pre code {
        color: black;
        -comment: "感谢评论区 https://github.com/lx200916 指出博客代码块深色模式问题";
    }
</style>
<script src="https://unpkg.com/zoomtastic@2.2.1"></script>
<script data-selector="code.language-kotlin" src="https://unpkg.com/kotlin-playground@1"></script>
<script>
    document.addEventListener("DOMContentLoaded", function(event) { 
        document.querySelectorAll("div.post-body-wrapper img").forEach(function(element){
            element.setAttribute("zoomtastic", true)
            element.style.maxWidth="60%"
        })
		
		Zoomtastic.mount({
			size: '95%',
			easing: 'ease',
			duration: 300,
			background: 'rgba(0, 0, 0, 0.9)',
			filter: 'drop-shadow(0 2px 16px rgba(0, 0, 0, 0.3))',
			animation: 'slide' 
		});
		
		Zoomtastic.listen('[zoomtastic]', 'src');
    });

	
	var _hmt = _hmt || [];
	(function() {
	var hm = document.createElement("script");
	hm.src = "https://hm.baidu.com/hm.js?298c58938f9266e6098936c4f71a9a83";
	var s = document.getElementsByTagName("script")[0]; 
	s.parentNode.insertBefore(hm, s);
	})();

</script>
</head>
<body>
<div id="app"><div class="side-container" id="sideContainer">
<a class="a-block nav-head false" href="https://ntutn.top/">
<div class="nav-title">
            归零幻想
        </div>
<div class="nav-subtitle">
            零点还不算熬夜
        </div>
</a>
<div class="nav-link-list">
<a class="a-block nav-link-item false" href="/project">
                项目
            </a>
<a class="a-block nav-link-item false" href="/tags">
                标签
            </a>
<a class="a-block nav-link-item active" href="/posts">
                归档
            </a>
<a class="a-block nav-link-item false" href="/friends">
                友链
            </a>
<a class="a-block nav-link-item false" href="/about">
                关于
            </a>
<a class="a-block nav-link-item false" href="/index.xml">
                RSS
            </a>
</div>
<div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br/>
移植自 <a href="https://mak1t0.cc/" rel="noreferrer noopener" target="_blank">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" rel="noreferrer noopener" target="_blank">Journal.</a> <br/>
<br/>

©
	
	CC BY-SA 4.0
	

    </div>
</div><div class="extra-container" id="extraContainer">
<div :class="{ invisible: scrollY &lt;= 140 }" class="toc animated-visibility">
<div class="toc-content">
<center>- 目录 -</center>
<ul>
<li>
<a href="#activity" id="activity-nav" onclick="onNavClick(`#activity-nav`)">
									Activity
								</a>
</li>
<ul>
<li>
<a href="#activity%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95" id="activity基本用法-nav" onclick="onNavClick(`#activity基本用法-nav`)">
									Activity基本用法
								</a>
</li>
<li>
<a href="#%e5%9c%a8activity%e4%b9%8b%e9%97%b4%e8%b7%b3%e8%bd%ac" id="在activity之间跳转-nav" onclick="onNavClick(`#在activity之间跳转-nav`)">
									在Activity之间跳转
								</a>
</li>
<ul>
<li>
<a href="#%e6%98%be%e5%bc%8fintent" id="显式intent-nav" onclick="onNavClick(`#显式intent-nav`)">
									显式Intent
								</a>
</li>
<li>
<a href="#%e9%9a%90%e5%bc%8fintent" id="隐式intent-nav" onclick="onNavClick(`#隐式intent-nav`)">
									隐式Intent
								</a>
</li>
<ul>
<li>
<a href="#%e5%90%af%e5%8a%a8%e7%b3%bb%e7%bb%9f%e5%85%b6%e4%bb%96activity" id="启动系统其他activity-nav" onclick="onNavClick(`#启动系统其他activity-nav`)">
									启动系统其他Activity
								</a>
</li>
</ul>
<li>
<a href="#%e5%90%91%e4%b8%8b%e4%b8%80%e4%b8%aaactivity%e4%bc%a0%e9%80%92%e6%95%b0%e6%8d%ae" id="向下一个activity传递数据-nav" onclick="onNavClick(`#向下一个activity传递数据-nav`)">
									向下一个Activity传递数据
								</a>
</li>
<li>
<a href="#%e8%bf%94%e5%9b%9e%e6%95%b0%e6%8d%ae%e7%bb%99%e4%b8%8a%e4%b8%80%e4%b8%aaactivity" id="返回数据给上一个activity-nav" onclick="onNavClick(`#返回数据给上一个activity-nav`)">
									返回数据给上一个Activity
								</a>
</li>
</ul>
<li>
<a href="#activity%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" id="activity的生命周期-nav" onclick="onNavClick(`#activity的生命周期-nav`)">
									Activity的生命周期
								</a>
</li>
<ul>
<li>
<a href="#%e8%bf%94%e5%9b%9e%e6%a0%88" id="返回栈-nav" onclick="onNavClick(`#返回栈-nav`)">
									返回栈
								</a>
</li>
<li>
<a href="#activity%e7%9a%84%e7%8a%b6%e6%80%81" id="activity的状态-nav" onclick="onNavClick(`#activity的状态-nav`)">
									Activity的状态
								</a>
</li>
<li>
<a href="#activity%e7%9a%84%e7%94%9f%e5%ad%98%e6%9c%9f" id="activity的生存期-nav" onclick="onNavClick(`#activity的生存期-nav`)">
									Activity的生存期
								</a>
</li>
</ul>
<li>
<a href="#activity%e7%9a%84%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f" id="activity的启动模式-nav" onclick="onNavClick(`#activity的启动模式-nav`)">
									Activity的启动模式
								</a>
</li>
<ul>
<li>
<a href="#standard" id="standard-nav" onclick="onNavClick(`#standard-nav`)">
									standard
								</a>
</li>
<li>
<a href="#singletop" id="singletop-nav" onclick="onNavClick(`#singletop-nav`)">
									singleTop
								</a>
</li>
<li>
<a href="#singletask" id="singletask-nav" onclick="onNavClick(`#singletask-nav`)">
									singleTask
								</a>
</li>
<li>
<a href="#singleinstance" id="singleinstance-nav" onclick="onNavClick(`#singleinstance-nav`)">
									singleInstance
								</a>
</li>
</ul>
<li>
<a href="#activity%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" id="activity最佳实践-nav" onclick="onNavClick(`#activity最佳实践-nav`)">
									Activity最佳实践
								</a>
</li>
<ul>
<li>
<a href="#%e7%9f%a5%e9%81%93%e5%bd%93%e5%89%8d%e5%9c%a8%e5%93%aa%e4%b8%aaactivity" id="知道当前在哪个activity-nav" onclick="onNavClick(`#知道当前在哪个activity-nav`)">
									知道当前在哪个Activity
								</a>
</li>
<li>
<a href="#%e9%9a%8f%e6%97%b6%e9%9a%8f%e5%9c%b0%e9%80%80%e5%87%ba%e7%a8%8b%e5%ba%8f" id="随时随地退出程序-nav" onclick="onNavClick(`#随时随地退出程序-nav`)">
									随时随地退出程序
								</a>
</li>
<li>
<a href="#%e5%90%af%e5%8a%a8activity%e7%9a%84%e6%9c%80%e4%bd%b3%e5%86%99%e6%b3%95" id="启动activity的最佳写法-nav" onclick="onNavClick(`#启动activity的最佳写法-nav`)">
									启动Activity的最佳写法
								</a>
</li>
</ul>
</ul></ul></div>
</div>
<div class="pagination">
<a :class="{ invisible: scrollY == 0 }" class="pagination-action animated-visibility" href="#top" id="globalBackToTop">
<i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
</a>
<a class="pagination-action" id="darkModeToggleButton" type="button">
<span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
</a>
</div>
</div>
<div class="single-column-drawer-container" id="drawer" v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
<div class="drawer-content">
<div class="drawer-menu">
<a class="a-block drawer-menu-item false" href="/project">
                    项目
                </a>
<a class="a-block drawer-menu-item false" href="/tags">
                    标签
                </a>
<a class="a-block drawer-menu-item active" href="/posts">
                    归档
                </a>
<a class="a-block drawer-menu-item false" href="/friends">
                    友链
                </a>
<a class="a-block drawer-menu-item false" href="/about">
                    关于
                </a>
<a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS
                </a>
<div class="toc">
<div class="toc-content">
<center>- 目录 -</center>
<ul>
<li>
<a href="#activity" id="activity-nav" onclick="onNavClick(`#activity-nav`)">
									Activity
								</a>
</li>
<ul>
<li>
<a href="#activity%e5%9f%ba%e6%9c%ac%e7%94%a8%e6%b3%95" id="activity基本用法-nav" onclick="onNavClick(`#activity基本用法-nav`)">
									Activity基本用法
								</a>
</li>
<li>
<a href="#%e5%9c%a8activity%e4%b9%8b%e9%97%b4%e8%b7%b3%e8%bd%ac" id="在activity之间跳转-nav" onclick="onNavClick(`#在activity之间跳转-nav`)">
									在Activity之间跳转
								</a>
</li>
<ul>
<li>
<a href="#%e6%98%be%e5%bc%8fintent" id="显式intent-nav" onclick="onNavClick(`#显式intent-nav`)">
									显式Intent
								</a>
</li>
<li>
<a href="#%e9%9a%90%e5%bc%8fintent" id="隐式intent-nav" onclick="onNavClick(`#隐式intent-nav`)">
									隐式Intent
								</a>
</li>
<ul>
<li>
<a href="#%e5%90%af%e5%8a%a8%e7%b3%bb%e7%bb%9f%e5%85%b6%e4%bb%96activity" id="启动系统其他activity-nav" onclick="onNavClick(`#启动系统其他activity-nav`)">
									启动系统其他Activity
								</a>
</li>
</ul>
<li>
<a href="#%e5%90%91%e4%b8%8b%e4%b8%80%e4%b8%aaactivity%e4%bc%a0%e9%80%92%e6%95%b0%e6%8d%ae" id="向下一个activity传递数据-nav" onclick="onNavClick(`#向下一个activity传递数据-nav`)">
									向下一个Activity传递数据
								</a>
</li>
<li>
<a href="#%e8%bf%94%e5%9b%9e%e6%95%b0%e6%8d%ae%e7%bb%99%e4%b8%8a%e4%b8%80%e4%b8%aaactivity" id="返回数据给上一个activity-nav" onclick="onNavClick(`#返回数据给上一个activity-nav`)">
									返回数据给上一个Activity
								</a>
</li>
</ul>
<li>
<a href="#activity%e7%9a%84%e7%94%9f%e5%91%bd%e5%91%a8%e6%9c%9f" id="activity的生命周期-nav" onclick="onNavClick(`#activity的生命周期-nav`)">
									Activity的生命周期
								</a>
</li>
<ul>
<li>
<a href="#%e8%bf%94%e5%9b%9e%e6%a0%88" id="返回栈-nav" onclick="onNavClick(`#返回栈-nav`)">
									返回栈
								</a>
</li>
<li>
<a href="#activity%e7%9a%84%e7%8a%b6%e6%80%81" id="activity的状态-nav" onclick="onNavClick(`#activity的状态-nav`)">
									Activity的状态
								</a>
</li>
<li>
<a href="#activity%e7%9a%84%e7%94%9f%e5%ad%98%e6%9c%9f" id="activity的生存期-nav" onclick="onNavClick(`#activity的生存期-nav`)">
									Activity的生存期
								</a>
</li>
</ul>
<li>
<a href="#activity%e7%9a%84%e5%90%af%e5%8a%a8%e6%a8%a1%e5%bc%8f" id="activity的启动模式-nav" onclick="onNavClick(`#activity的启动模式-nav`)">
									Activity的启动模式
								</a>
</li>
<ul>
<li>
<a href="#standard" id="standard-nav" onclick="onNavClick(`#standard-nav`)">
									standard
								</a>
</li>
<li>
<a href="#singletop" id="singletop-nav" onclick="onNavClick(`#singletop-nav`)">
									singleTop
								</a>
</li>
<li>
<a href="#singletask" id="singletask-nav" onclick="onNavClick(`#singletask-nav`)">
									singleTask
								</a>
</li>
<li>
<a href="#singleinstance" id="singleinstance-nav" onclick="onNavClick(`#singleinstance-nav`)">
									singleInstance
								</a>
</li>
</ul>
<li>
<a href="#activity%e6%9c%80%e4%bd%b3%e5%ae%9e%e8%b7%b5" id="activity最佳实践-nav" onclick="onNavClick(`#activity最佳实践-nav`)">
									Activity最佳实践
								</a>
</li>
<ul>
<li>
<a href="#%e7%9f%a5%e9%81%93%e5%bd%93%e5%89%8d%e5%9c%a8%e5%93%aa%e4%b8%aaactivity" id="知道当前在哪个activity-nav" onclick="onNavClick(`#知道当前在哪个activity-nav`)">
									知道当前在哪个Activity
								</a>
</li>
<li>
<a href="#%e9%9a%8f%e6%97%b6%e9%9a%8f%e5%9c%b0%e9%80%80%e5%87%ba%e7%a8%8b%e5%ba%8f" id="随时随地退出程序-nav" onclick="onNavClick(`#随时随地退出程序-nav`)">
									随时随地退出程序
								</a>
</li>
<li>
<a href="#%e5%90%af%e5%8a%a8activity%e7%9a%84%e6%9c%80%e4%bd%b3%e5%86%99%e6%b3%95" id="启动activity的最佳写法-nav" onclick="onNavClick(`#启动activity的最佳写法-nav`)">
									启动Activity的最佳写法
								</a>
</li>
</ul>
</ul></ul></div>
</div>
</div>
</div>
</div>
<transition name="fade">
<div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav class="navbar sticky-top navbar-light single-column-nav-container" id="navBar">
<div class="nav-background" id="navBackground"></div>
<div class="container container-narrow nav-content">
<button class="nav-dropdown-toggle" id="nav_dropdown_btn" type="button" v-on:click="toggleDrawer">
<i class="material-icons">
                menu
            </i>
</button>
<a class="navbar-brand" href="https://ntutn.top/" id="navTitle">
            归零幻想
        </a>
<button class="nav-darkmode-toggle" id="darkModeToggleButton2" type="button">
<i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
</button>
</div>
</nav>
<div class="single-column-header-container" id="pageHead" v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
<a href="https://ntutn.top/">
<div class="single-column-header-title">归零幻想</div>
<div class="single-column-header-subtitle">零点还不算熬夜</div>
</a>
</div>
<div id="content">
<div class="stream-container" id="streamContainer">
<div class="post-list-container post-list-container-shadow">
<div class="post">
<div class="post-head-wrapper" style="background-image: url('https://i.loli.net/2020/12/10/K7pyaXDeSVzqc8Y.jpg')">
<div class="post-title">
                    android项目开发：Activity
                    
                    <div class="post-subtitle">
                        Activity
                    </div>
<div class="post-meta">
<time itemprop="datePublished">
                            2020-12-15 03:11
                        </time>
<i class="material-icons" style="">folder</i>
<a href="/categories/%E7%BC%96%E7%A8%8B">编程</a>
                                 
                        

                        
                            <i class="material-icons" style="">label</i>
<a href="/tags/android">android</a>
                                 
                            
                                <a href="/tags/%E7%AC%AC%E4%B8%80%E8%A1%8C%E4%BB%A3%E7%A0%81">第一行代码</a>
                                 
                            
                                <a href="/tags/kotlin">Kotlin</a>
                                 
                            
                                <a href="/tags/activity">Activity</a>
                                 
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            10 min
                            
                            14 s.
                        
                    </div>
</div>
</div>
<div class="post-body-wrapper">
<div class="post-body" v-pre="">
<!-- raw HTML omitted -->
<p>title: android项目开发：Activity
author: 归零幻想
publishDate: 2020-12-15
editDate: 2020-12-15
tags: [android, 第一行代码, Kotlin, Activity]</p>
<!-- raw HTML omitted -->
<blockquote>
<p>仍然是《第一行代码》的读书笔记，可能引用原书的定义和描述，或代码案例。</p>
</blockquote>
<h1 id="activity">Activity</h1>
<h2 id="activity基本用法">Activity基本用法</h2>
<p>Android讲究设计逻辑与视图分离，一般Activity都会对应一个布局文件（XML文件）。</p>
<p>所有的Activity都要在AndroidManifest中注册才生效。</p>
<p>Activity可以创建菜单。首先在<code>res/menu</code>下创建一个xml文件（Android Studio中也提供了可视化编辑的方法）：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-xml" data-lang="xml"><span style="color:#1e889b">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;menu</span> <span style="color:#658b00">xmlns:app=</span><span style="color:#cd5555">"http://schemas.android.com/apk/res-auto"</span>
      <span style="color:#658b00">xmlns:android=</span><span style="color:#cd5555">"http://schemas.android.com/apk/res/android"</span><span style="color:#8b008b;font-weight:bold">&gt;</span>

    <span style="color:#8b008b;font-weight:bold">&lt;item</span>
            <span style="color:#658b00">android:id=</span><span style="color:#cd5555">"@+id/add_item"</span>
            <span style="color:#658b00">android:title=</span><span style="color:#cd5555">"Add"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;item</span>
            <span style="color:#658b00">android:id=</span><span style="color:#cd5555">"@+id/remove_item"</span>
            <span style="color:#658b00">android:title=</span><span style="color:#cd5555">"Remove"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;/menu&gt;</span>
</code></pre></div><p>重写两个方法</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin">    <span style="color:#8b008b;font-weight:bold">override</span> <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">onCreateOptionsMenu</span>(menu: Menu?): Boolean {
    menuInflater.inflate(R.menu.main, menu)
    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">true</span>
}
<span style="color:#8b008b;font-weight:bold">override</span> <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">onOptionsItemSelected</span>(item: MenuItem): Boolean {
    <span style="color:#8b008b;font-weight:bold">when</span> (item.itemId) {
        R.id.add_item -&gt; Toast.makeText(<span style="color:#8b008b;font-weight:bold">this</span>, <span style="color:#cd5555">"Add a book."</span>, Toast.LENGTH_LONG).show()
        R.id.remove_item -&gt; Toast.makeText(<span style="color:#8b008b;font-weight:bold">this</span>, <span style="color:#cd5555">"Remove a book."</span>, Toast.LENGTH_LONG).show()
    }
    <span style="color:#8b008b;font-weight:bold">return</span> <span style="color:#8b008b;font-weight:bold">true</span>
}
</code></pre></div><p><img alt="photo_2020-12-10_21-00-32.jpg" src="https://i.loli.net/2020/12/10/a6wOcTFrHLhS4il.jpg"/></p>
<p>用<code>finish()</code>方法可以关闭一个Activity。</p>
<!-- raw HTML omitted -->
<h2 id="在activity之间跳转">在Activity之间跳转</h2>
<h3 id="显式intent">显式Intent</h3>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin">jumpButton.setOnClickListener {
    startActivity(Intent(<span style="color:#8b008b;font-weight:bold">this</span>, SecondActivity::<span style="color:#8b008b;font-weight:bold">class</span>.java))
}
</code></pre></div><h3 id="隐式intent">隐式Intent</h3>
<p>首先在<code>AndroidManifest.xml</code>中注册</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-xml" data-lang="xml">
<span style="color:#8b008b;font-weight:bold">&lt;activity</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">".SecondActivity"</span><span style="color:#8b008b;font-weight:bold">&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;intent-filter&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;action</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">"com.example.myapplication.ACTION_START"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;category</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">"android.intent.category.DEFAULT"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;/intent-filter&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;/activity&gt;</span>
</code></pre></div><p>修改启动Activity的代码：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin">startActivity(Intent(<span style="color:#cd5555">"com.example.myapplication.ACTION_START"</span>))
</code></pre></div><p>action是动作，category是一些附加信息。只有action和category完全匹配才能正确启动Activity。</p>
<p>接下来我们修改上述代码验证这一点。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-xml" data-lang="xml">
<span style="color:#8b008b;font-weight:bold">&lt;activity</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">".SecondActivity"</span><span style="color:#8b008b;font-weight:bold">&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;intent-filter&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;action</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">"com.example.myapplication.ACTION_START"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;category</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">"android.intent.category.DEFAULT"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
        <span style="color:#8b008b;font-weight:bold">&lt;category</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">"com.example.myapplication.MY_CATEGORY"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;/intent-filter&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;/activity&gt;</span>
</code></pre></div><div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">val</span> myIntent = Intent(<span style="color:#cd5555">"com.example.myapplication.ACTION_START"</span>)
myIntent.addCategory(<span style="color:#cd5555">"com.example.myapplication.MY_CATEGORY"</span>)
startActivity(myIntent)
</code></pre></div><h4 id="启动系统其他activity">启动系统其他Activity</h4>
<p>可以通过这样的代码启动系统浏览器：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">val</span> intent = Intent(Intent.ACTION_VIEW)
intent.<span style="color:#8b008b;font-weight:bold">data</span> = Uri.parse(<span style="color:#cd5555">"https://ntutn.top"</span>)
startActivity(intent)
</code></pre></div><p><code>Intent.ACTION_VIEW</code>实际上是<code>android.intent.action.VIEW</code>，如果我们注册下这个action也能冒充系统浏览器。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-xml" data-lang="xml">
<span style="color:#8b008b;font-weight:bold">&lt;intent-filter&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;action</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">"android.intent.action.VIEW"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;category</span> <span style="color:#658b00">android:name=</span><span style="color:#cd5555">"android.intent.category.DEFAULT"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
    <span style="color:#8b008b;font-weight:bold">&lt;data</span> <span style="color:#658b00">android:scheme=</span><span style="color:#cd5555">"https"</span><span style="color:#8b008b;font-weight:bold">/&gt;</span>
<span style="color:#8b008b;font-weight:bold">&lt;/intent-filter&gt;</span>
</code></pre></div><p><img alt="photo_2020-12-10_23-21-57.jpg" src="https://i.loli.net/2020/12/10/K7pyaXDeSVzqc8Y.jpg"/></p>
<h3 id="向下一个activity传递数据">向下一个Activity传递数据</h3>
<p>通过Intent的putExtra方法。在第一个Activity中：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin">            intent.putExtra(<span style="color:#cd5555">"extra_data"</span>, <span style="color:#cd5555">"I'm IF. IF 3279. "</span>)
</code></pre></div><p>在第二个Activity中：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin">        Toast.makeText(<span style="color:#8b008b;font-weight:bold">this</span>, intent.getStringExtra(<span style="color:#cd5555">"extra_data"</span>), Toast.LENGTH_LONG).show()
</code></pre></div><h3 id="返回数据给上一个activity">返回数据给上一个Activity</h3>
<p>首先看看书上的方法。 第一个Activity中：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">val</span> intent = Intent(<span style="color:#8b008b;font-weight:bold">this</span>, SecondActivity::<span style="color:#8b008b;font-weight:bold">class</span>.java)
startActivityForResult(intent, REQ_1)
</code></pre></div><p>然后重写一个方法接收结果</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">override</span> <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">onActivityResult</span>(requestCode: Int, resultCode: Int, <span style="color:#8b008b;font-weight:bold">data</span>: Intent?) {
    <span style="color:#8b008b;font-weight:bold">super</span>.onActivityResult(requestCode, resultCode, <span style="color:#8b008b;font-weight:bold">data</span>)
    <span style="color:#8b008b;font-weight:bold">when</span> (requestCode) {
        REQ_1 -&gt; <span style="color:#8b008b;font-weight:bold">if</span> (resultCode == RESULT_OK) {
            Toast.makeText(<span style="color:#8b008b;font-weight:bold">this</span>, <span style="color:#cd5555">"点击按钮返回数据：</span><span style="color:#cd5555">${data?.getStringExtra("data_return")}</span><span style="color:#cd5555">。"</span>, Toast.LENGTH_LONG).show()
        }
    }
}
</code></pre></div><p>用这样的方法在第二个Activity中返回数据</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin">intent.putExtra(<span style="color:#cd5555">"data_return"</span>, <span style="color:#cd5555">"Hello FirstActivity"</span>)
setResult(RESULT_OK, intent)
finish()
</code></pre></div><p>不过不得不说安卓迭代是真的快啊，现在AS已经提示我这种方法过时了。于是去找找现在最新的技术是啥。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">val</span> testActivityResult =
    registerForActivityResult(ActivityResultContracts.StartActivityForResult()) {
        <span style="color:#8b008b;font-weight:bold">if</span> (<span style="color:#8b008b;font-weight:bold">it</span>.resultCode == Activity.RESULT_OK) {
            Toast.makeText(
                <span style="color:#8b008b;font-weight:bold">this</span>,
                <span style="color:#cd5555">"点击按钮返回数据：</span><span style="color:#cd5555">${it.data?.getStringExtra("data_return")}</span><span style="color:#cd5555">。"</span>,
                Toast.LENGTH_LONG
            ).show()
        }
    }
<span style="color:#228b22">//在需要启动另一个Activity的地方
</span><span style="color:#228b22"></span>testActivityResult.launch(intent)
</code></pre></div><h2 id="activity的生命周期">Activity的生命周期</h2>
<h3 id="返回栈">返回栈</h3>
<p>Activity可以层叠，每当启动一个Activity它将入栈，位于返回栈的栈顶。而如果销毁Activity，它将出栈，下一个栈顶的Activity则被显示给用户。</p>
<h3 id="activity的状态">Activity的状态</h3>
<table>
<thead>
<tr>
<th>状态</th>
<th>说明</th>
<th>回收策略</th>
</tr>
</thead>
<tbody>
<tr>
<td>运行状态</td>
<td>Activity处于返回栈的栈顶</td>
<td>最不倾向于被回收</td>
</tr>
<tr>
<td>暂停状态</td>
<td>不处于栈顶，但仍然可见<sup id="fnref:1"><a class="footnote-ref" href="#fn:1" role="doc-noteref">1</a></sup></td>
<td>只有在内存极低的情况下才会回收</td>
</tr>
<tr>
<td>停止状态</td>
<td>不处于栈顶，且完全不可见</td>
<td>可能被回收</td>
</tr>
<tr>
<td>销毁状态</td>
<td>从返回栈移除后</td>
<td>最倾向于被回收</td>
</tr>
</tbody>
</table>
<h3 id="activity的生存期">Activity的生存期</h3>
<p><img alt="lifecycle.jpg" src="https://i.loli.net/2020/12/14/dNqfoY4XOaFC2Es.jpg"/></p>
<table>
<thead>
<tr>
<th>方法</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>onCreate()</code></td>
<td>Activity<strong>第一次</strong>被创建。应完成初始化操作，创建布局，绑定事件</td>
</tr>
<tr>
<td><code>onStart()</code></td>
<td>Activity由不可见变为可见。</td>
</tr>
<tr>
<td><code>onResume()</code></td>
<td>Activity准备好和用户交互。此时Activity处于<strong>运行状态</strong></td>
</tr>
<tr>
<td><code>onPause()</code></td>
<td>系统准备启动或恢复另一个Activity时。应释放资源，保存关键数据。</td>
</tr>
<tr>
<td><code>onStop()</code></td>
<td>Activity完全不可用时调用。</td>
</tr>
<tr>
<td><code>onDestory()</code></td>
<td>Activity被销毁前被调用。</td>
</tr>
<tr>
<td><code>onRestart()</code></td>
<td>停止状态变为运行状态前被调用。</td>
</tr>
</tbody>
</table>
<ul>
<li>完整生存期 <code>onCreate()</code>——<code>onDestory()</code></li>
<li>可见生存期 <code>onStart()</code>——<code>onStop()</code></li>
<li>前台生存期 <code>onResume()</code>——<code>onPause()</code></li>
</ul>
<h2 id="activity的启动模式">Activity的启动模式</h2>
<p>在<code>AndroidManifest.xml</code>中指定activity标签的<code>android:launchMode</code>属性。</p>
<h3 id="standard">standard</h3>
<p>默认模式。总是创建一个新实例。</p>
<h3 id="singletop">singleTop</h3>
<p>若目标Activity已经在栈顶，则直接启动。</p>
<h3 id="singletask">singleTask</h3>
<p>若目标Activity已经在栈中，则将其上Activity出栈并启动。</p>
<h3 id="singleinstance">singleInstance</h3>
<p>启用一个新的返回栈管理Activity，一般用于多个程序共享Activity。</p>
<h2 id="activity最佳实践">Activity最佳实践</h2>
<h3 id="知道当前在哪个activity">知道当前在哪个Activity</h3>
<p>准备一个<code>BaseActivity</code>，让其他所有Activity继承自它。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">package</span> <span style="color:#008b45;text-decoration:underline">top.ntutn.activcitylifecycletest</span>
<span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">android.os.Bundle</span>
<span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">android.util.Log</span>
<span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">androidx.appcompat.app.AppCompatActivity</span>
<span style="color:#8b008b;font-weight:bold">open</span> <span style="color:#8b008b;font-weight:bold">class</span> <span style="color:#008b45;font-weight:bold">BaseActivity</span> : AppCompatActivity() {
    <span style="color:#8b008b;font-weight:bold">override</span> <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">onCreate</span>(savedInstanceState: Bundle?) {
        <span style="color:#8b008b;font-weight:bold">super</span>.onCreate(savedInstanceState)
        Log.d(TAG, <span style="color:#cd5555">"</span><span style="color:#cd5555">${javaClass.simpleName}</span><span style="color:#cd5555"> onCreate."</span>)
    }
    <span style="color:#8b008b;font-weight:bold">companion</span> <span style="color:#8b008b;font-weight:bold">object</span> {
        <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">const</span> <span style="color:#8b008b;font-weight:bold">val</span> TAG = <span style="color:#cd5555">"BaseActivity"</span>
    }
}
</code></pre></div><h3 id="随时随地退出程序">随时随地退出程序</h3>
<p>可以准备一个类将当前所有Activity管理起来。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">package</span> <span style="color:#008b45;text-decoration:underline">top.ntutn.activcitylifecycletest</span>
<span style="color:#8b008b;font-weight:bold">import</span> <span style="color:#008b45;text-decoration:underline">android.app.Activity</span>
<span style="color:#8b008b;font-weight:bold">object</span> <span style="color:#008b45;font-weight:bold">ActivityHelper</span> {
    <span style="color:#8b008b;font-weight:bold">private</span> <span style="color:#8b008b;font-weight:bold">val</span> activities = arrayListOf&lt;Activity&gt;()
    <span style="color:#228b22">/**
</span><span style="color:#228b22">     * onCreate时
</span><span style="color:#228b22">     */</span>
    <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">addActivity</span>(activity: Activity) {
        activities.add(activity)
    }
    <span style="color:#228b22">/**
</span><span style="color:#228b22">     * onDestory时
</span><span style="color:#228b22">     */</span>
    <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">removeActivity</span>(activity: Activity) {
        activities.remove(activity)
    }
    <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">finishAll</span>() {
        <span style="color:#8b008b;font-weight:bold">for</span> (activity <span style="color:#8b008b;font-weight:bold">in</span> activities) {
            <span style="color:#8b008b;font-weight:bold">if</span> (!activity.isFinishing) {
                activity.finish()
            }
        }
    }
}
</code></pre></div><p>然后，在<code>BaseActivity</code>中将Activity注册到这里。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">override</span> <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">onCreate</span>(savedInstanceState: Bundle?) {
    <span style="color:#8b008b;font-weight:bold">super</span>.onCreate(savedInstanceState)
    Log.d(TAG, <span style="color:#cd5555">"</span><span style="color:#cd5555">${javaClass.simpleName}</span><span style="color:#cd5555"> onCreate."</span>)
    ActivityHelper.addActivity(<span style="color:#8b008b;font-weight:bold">this</span>)
}
<span style="color:#8b008b;font-weight:bold">override</span> <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">onDestroy</span>() {
    <span style="color:#8b008b;font-weight:bold">super</span>.onDestroy()
    Log.d(TAG, <span style="color:#cd5555">"</span><span style="color:#cd5555">${javaClass.simpleName}</span><span style="color:#cd5555"> onDestory"</span>)
    ActivityHelper.removeActivity(<span style="color:#8b008b;font-weight:bold">this</span>)
}
</code></pre></div><p>这样就可以随时使用<code>ActivityHelper.finishAll()</code>来关闭所有Activity了。</p>
<h3 id="启动activity的最佳写法">启动Activity的最佳写法</h3>
<blockquote>
<p>作为一个成熟的Activity，你应该会自己启动自己了。
建议Activity自己实现一个启动Activity的方法，这样外部调用时就能一目了然看出这个Activity需要什么参数。</p>
</blockquote>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin"><span style="color:#8b008b;font-weight:bold">companion</span> <span style="color:#8b008b;font-weight:bold">object</span> {
    <span style="color:#8b008b;font-weight:bold">fun</span> <span style="color:#008b45">actionStart</span>(context: Context, title: String?, content: String?) {
        <span style="color:#8b008b;font-weight:bold">val</span> intent = Intent(context, DialogActivity::<span style="color:#8b008b;font-weight:bold">class</span>.java)
        intent.putExtra(<span style="color:#cd5555">"title"</span>, title)
        intent.putExtra(<span style="color:#cd5555">"content"</span>, content)
        context.startActivity(intent)
    }
}
</code></pre></div><p>这样外部调用只需要</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4" tabindex="0"><code class="language-kotlin" data-lang="kotlin">DialogActivity.actionStart(<span style="color:#8b008b;font-weight:bold">this</span>, <span style="color:#cd5555">"MyDialog"</span>, <span style="color:#cd5555">"作为一个成熟的Activity，你应该会自己启动自己了。"</span>)
</code></pre></div><section class="footnotes" role="doc-endnotes">
<hr/>
<ol>
<li id="fn:1" role="doc-endnote">
<p>Activity不一定会占满整个屏幕，所以下方没有被激活但仍然可见。很多应用用一像素Activity保活就是利用了这一点。 <a class="footnote-backref" href="#fnref:1" role="doc-backlink">↩︎</a></p>
</li>
</ol>
</section>
<hr id="EOF" width="100%"/>
<p style="color:#777;">最后修改于 2020-12-15</p>
</div>
</div>
<nav class="post-pagination">
<a class="newer-posts" href="/posts/ui%E8%AE%BE%E8%AE%A1/">
			下回<br/>android项目开发：UI设计
                </a>
<a class="older-posts" href="/posts/%E5%86%99%E4%BA%A7%E5%93%81%E5%92%8C%E5%86%99demo%E7%9A%84%E5%8C%BA%E5%88%AB/">
			上回<br/>写产品和写demo的区别
                </a>
</nav>
<div class="post-comment-wrapper">
<script async="" crossorigin="anonymous" issue-term="title" label="" repo="zerofancy/zerofancy.github.io" src="https://utteranc.es/client.js" theme="github-light">
</script>
</div>
</div>
</div>
</div>
</div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br/>
移植自 <a href="https://mak1t0.cc/" rel="noreferrer noopener" target="_blank">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" rel="noreferrer noopener" target="_blank">Journal.</a> <br/>
<br/>

©
	
	CC BY-SA 4.0
	
</div>
</div>
<script src="/js/journal.js"></script></body>
</html>
