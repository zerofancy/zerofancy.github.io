<!DOCTYPE html>
<html><head>
<title>写产品和写demo的区别</title>




<meta charset="utf-8">
<meta name="X-UA-Compatible" content="IE=edge">
<meta name="google-site-verification" content="">
<meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport">
<meta content="telephone=no" name="format-detection">
<meta name="description" content="写产品和写demo的区别">
<meta name="renderer" content="webkit">
<meta name="theme-color" content="#ffffff">



<meta property="og:title" content="写产品和写demo的区别" />
<meta property="og:description" content="写产品和写demo的区别" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://ntutn.top/posts/%E5%86%99%E4%BA%A7%E5%93%81%E5%92%8C%E5%86%99demo%E7%9A%84%E5%8C%BA%E5%88%AB/" />
<meta property="article:published_time" content="2020-12-15T03:11:37+08:00" />
<meta property="article:modified_time" content="2020-12-15T03:11:37+08:00" /><meta property="og:site_name" content="归零幻想" />










<link type="text/css" rel="stylesheet" href="/vendor/css/bootstrap.min.css">


  




<link rel="icon" href="//images.ntutn.top/favicon.ico">



<link rel="stylesheet" href="https://ntutn.top/scss/journal.min.d8d9f81b896882733c41896750adbefbf9319ca02ccccefd461650898975c3af.css" integrity="sha256-2Nn4G4lognM8QYlnUK2&#43;&#43;/kxnKAszM79RhZQiYl1w68=" media="screen">



<link rel="stylesheet" href="https://ntutn.top/scss/dark-mode.min.60f86847da9fc0724177ccfd0bf7c5997b0b41f1e58d5a293cfb3723c497c422.css" integrity="sha256-YPhoR9qfwHJBd8z9C/fFmXsLQfHljVopPPs3I8SXxCI=" media="screen">


<script src="/vendor/js/loadCSS.js"></script>
<script>
  loadCSS("https://fonts.googleapis.com/css?family=Fira+Mono|Material+Icons");
</script>



<script defer
	src='https://static.cloudflareinsights.com/beacon.min.js'
	data-cf-beacon='{"token": 5a03d307f5214109a1e7c8b2cf306a3d'>
</script>






  <script src="/js/toc.js"></script>














</head>
<body>
    	<div id="app"><div id="sideContainer" class="side-container">
    
    <a class="a-block nav-head false" href="https://ntutn.top/">
    
        <div class="nav-title">
            归零幻想
        </div>
        
        <div class="nav-subtitle">
            零点还不算熬夜
        </div>
        
    </a>

    <div class="nav-link-list">
        
        
            
            
            
                
            
            
            
            <a class="a-block nav-link-item active" href="/posts">
                Archive
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/categories">
                Categories
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/tags">
                Tags
            </a>
            
        
            
            
            
            
            
            <a class="a-block nav-link-item false" href="/index.xml">
                RSS Feed
            </a>
            
        
    </div>

    

    <div class="nav-footer">
        
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	CC BY-SA 4.0
	

    </div>
    
</div><div id="extraContainer" class="extra-container">
    
    
    <div class="toc animated-visibility" :class="{ invisible: scrollY <= 140 }">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#kotlin%e7%9a%84%e7%a9%ba%e5%ae%89%e5%85%a8" onclick="onNavClick(`#kotlin的空安全-nav`)" id="kotlin的空安全-nav">
									Kotlin的空安全
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%88%a4%e7%a9%ba" onclick="onNavClick(`#判空-nav`)" id="判空-nav">
									判空
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%89%e5%85%a8%e8%b0%83%e7%94%a8" onclick="onNavClick(`#安全调用-nav`)" id="安全调用-nav">
									安全调用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#elvis-%e6%93%8d%e4%bd%9c%e7%ac%a6" onclick="onNavClick(`#elvis-操作符-nav`)" id="elvis-操作符-nav">
									Elvis 操作符
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%93%8d%e4%bd%9c%e7%ac%a6" onclick="onNavClick(`#操作符-nav`)" id="操作符-nav">
									!!操作符
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
    
    <div class="pagination">
        <a id="globalBackToTop" class="pagination-action animated-visibility" href="#top" :class="{ invisible: scrollY == 0 }">
            <i class="material-icons pagination-action-icon">
                keyboard_arrow_up
            </i>
        </a>
        
        <a type="button" class="pagination-action" id="darkModeToggleButton">
            <span class="material-icons pagination-action-icon" id="darkModeToggleIcon">
                dark_mode
            </span>
        </a>
        
        
    </div>
</div>
<div class="single-column-drawer-container" id="drawer"
     v-bind:class="{ 'single-column-drawer-container-active': isDrawerOpen }">
    <div class="drawer-content">
        <div class="drawer-menu">
            
            
            
                
                
                
                    
                
                
                
                <a class="a-block drawer-menu-item active" href="/posts">
                    Archive
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/categories">
                    Categories
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/tags">
                    Tags
                </a>
                
            
                
                
                
                
                
                <a class="a-block drawer-menu-item false" href="/index.xml">
                    RSS Feed
                </a>
                
            
            
            <div class="toc">


	<div class="toc-content">
	
		
		
		
		<center>- 目录 -</center>
		
		
		<ul>
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#kotlin%e7%9a%84%e7%a9%ba%e5%ae%89%e5%85%a8" onclick="onNavClick(`#kotlin的空安全-nav`)" id="kotlin的空安全-nav">
									Kotlin的空安全
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
							
								
									<ul>
								
							
						
						
							<li>
								<a href="#%e5%88%a4%e7%a9%ba" onclick="onNavClick(`#判空-nav`)" id="判空-nav">
									判空
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e5%ae%89%e5%85%a8%e8%b0%83%e7%94%a8" onclick="onNavClick(`#安全调用-nav`)" id="安全调用-nav">
									安全调用
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#elvis-%e6%93%8d%e4%bd%9c%e7%ac%a6" onclick="onNavClick(`#elvis-操作符-nav`)" id="elvis-操作符-nav">
									Elvis 操作符
								</a>
							</li>
						
						
					
				
			
				
				
					
						
						
						
						
						
							<li>
								<a href="#%e6%93%8d%e4%bd%9c%e7%ac%a6" onclick="onNavClick(`#操作符-nav`)" id="操作符-nav">
									!!操作符
								</a>
							</li>
						
						
					
				
			
		</ul>
	</div>

</div>
            
        </div>
    </div>
</div>
<transition name="fade">
    <div id="drawer-mask" v-bind:class="{ 'single-column-drawer-mask': mounted }" v-if="isDrawerOpen" v-on:click="toggleDrawer"></div>
</transition>
<nav id="navBar" class="navbar sticky-top navbar-light single-column-nav-container">
    <div id="navBackground" class="nav-background"></div>
    <div class="container container-narrow nav-content">
        <button id="nav_dropdown_btn" class="nav-dropdown-toggle" type="button" v-on:click="toggleDrawer">
            <i class="material-icons">
                menu
            </i>
        </button>
        <a id="navTitle" class="navbar-brand" href="https://ntutn.top/">
            归零幻想
        </a>
        
        <button type="button" class="nav-darkmode-toggle" id="darkModeToggleButton2">
            <i class="material-icons" id="darkModeToggleIcon2">
                dark_mode
            </i>
        </button>
        
    </div>
</nav>
<div class="single-column-header-container" id="pageHead"
     v-bind:style="{ transform: 'translateZ(0px) translateY('+.3*scrollY+'px)', opacity: 1-navOpacity }">
    <a href="https://ntutn.top/">
        <div class="single-column-header-title">归零幻想</div>
        
        <div class="single-column-header-subtitle">零点还不算熬夜</div>
        

    </a>
</div>

            <div id="content">
                <div id="streamContainer" class="stream-container">

    <div class="post-list-container post-list-container-shadow">
        <div class="post">
            
            
            

            <div class="post-head-wrapper-text-only"
                
            >
                <div class="post-title">
                    写产品和写demo的区别
                    
                    <div class="post-subtitle">
                        写产品和写demo的区别
                    </div>
                    
                    <div class="post-meta">
                        
                        <time itemprop="datePublished">
                            2020-12-15 03:11
                        </time>
                        

                        
                            <i class="material-icons" style="">folder</i>
                                <a href="/categories/todo">Todo</a>
                                &nbsp;
                        

                        
                            <i class="material-icons" style="">label</i>
                            
                                <a href="/tags/npe">NPE</a>
                                &nbsp;
                            
                                <a href="/tags/%E7%A9%BA%E6%8C%87%E9%92%88">空指针</a>
                                &nbsp;
                            
                                <a href="/tags/demo">demo</a>
                                &nbsp;
                            
                                <a href="/tags/kotlin">Kotlin</a>
                                &nbsp;
                            
                        
                        
                            <i class="material-icons" style="">schedule</i>
                            

                            
                            

                            
                            5 min
                            
                            41 s.
                        
                    </div>
                </div>
            </div>
            
            <div class="post-body-wrapper">
                
                <div class="post-body" v-pre>
                
                    <!-- raw HTML omitted -->
<p>上次写的功能灰度报了几例crash，定位是我这里某个变量NPE了。</p>
<p>说实话，在Java中NPE是我们最常打交道的异常了，但Kotlin提供的类型机制下，NPE很少了。而这里出现NPE，其实是因为我认定在当前这个流程中这个变量不会为空——你总是要先弹出菜单再点击菜单项吧，所以用了<code>data!!.id</code>的方式使用。</p>
<p>这个变量被赋值的地方只有三处，不存在多线程问题，我想破脑袋也不知道哪里为空了。最后处理只得暂时加上判空，先不崩再说。</p>
<p>请教同事，同事说我这是还没有分清 <strong>写产品和写demo的区别</strong> 。</p>
<!-- raw HTML omitted -->
<p>写产品和写demo的区别？仔细一想，的确有道理。『写demo』只要能跑通就行了，而写产品你是要为自己写的每一行代码负责的。我之前写过不少代码，但他们大概都算『写demo』。作业只要演示的时候不崩就行了，考试只要通过样例就行了，练手的项目写起来更是随心，反正自己就是用户，啥时候崩了啥时候debug，方便的很……</p>
<p>但『写产品』不同，你的程序不止要能完成需要的功能，还要在用户不按套路出牌的时候不出错。<em>今天你迟到一分钟，咱班四十个学生等你一分钟就是一节课，你浪费了大家一节课时间……</em> 虽然这么算不对，但也不能算全错。你的产品面向千千万万用户，任何小瑕疵都可能放大成一场事故。记得那个著名的ATM机的bug，就是因为用户选择了取消，然后插入了银行卡……</p>
<p>回到我这个Issue，虽然从业务逻辑的角度看用户操作后这个变量是不会为null的，但仍然应该有判空，有兜底的逻辑，这样你的程序才会更加健壮。</p>
<h2 id="kotlin的空安全">Kotlin的空安全</h2>
<p>与Java不同，Kotlin的类型系统在设计时就考虑了变量是否可空<sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup>，其用一个?表示变量是否能为空。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#8b008b;font-weight:bold">var</span> a: String = <span style="color:#cd5555">&#34;abc&#34;</span> <span style="color:#228b22">// 默认情况下，常规初始化意味着非空
</span><span style="color:#228b22"></span>a = <span style="color:#8b008b;font-weight:bold">null</span> <span style="color:#228b22">// 编译错误
</span></code></pre></div><div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#8b008b;font-weight:bold">var</span> b: String? = <span style="color:#cd5555">&#34;abc&#34;</span> <span style="color:#228b22">// 可以设置为空
</span><span style="color:#228b22"></span>b = <span style="color:#8b008b;font-weight:bold">null</span> <span style="color:#228b22">// ok
</span><span style="color:#228b22"></span>print(b)
</code></pre></div><h3 id="判空">判空</h3>
<p>Kotlin有一定的类型推断能力，判空后进行赋值操作前能识别出变量是非空的类型。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#8b008b;font-weight:bold">val</span> b: String? = <span style="color:#cd5555">&#34;Kotlin&#34;</span>
<span style="color:#8b008b;font-weight:bold">if</span> (b != <span style="color:#8b008b;font-weight:bold">null</span> &amp;&amp; b.length &gt; <span style="color:#b452cd">0</span>) {
    print(<span style="color:#cd5555">&#34;String of length </span><span style="color:#cd5555">${b.length}</span><span style="color:#cd5555">&#34;</span>)
} <span style="color:#8b008b;font-weight:bold">else</span> {
    print(<span style="color:#cd5555">&#34;Empty string&#34;</span>)
}
</code></pre></div><h3 id="安全调用">安全调用</h3>
<p>Kotlin中提供了<code>?.</code>来安全调用一个可能为空的变量。<code>b?.test()</code>相当于<code>if (b != null) b.test()</code>。</p>
<p>值得注意的是，这个操作符是可以和赋值语句一起用的。如：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt">b?.name = <span style="color:#cd5555">&#34;ByteDance&#34;</span>
</code></pre></div><p>换个形式可能更好理解：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#8b008b;font-weight:bold">if</span> (b != <span style="color:#8b008b;font-weight:bold">null</span>) b.setName(<span style="color:#cd5555">&#34;ByteDance&#34;</span>)
</code></pre></div><p>这个操作符还可以与<code>.let</code>配合，达到非空时执行特定语句的目的。</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt">b?.name?.let { println(<span style="color:#8b008b;font-weight:bold">it</span>) }
</code></pre></div><h3 id="elvis-操作符">Elvis 操作符</h3>
<p>在java中适当使用三元运算符也能让代码写起来更简洁一些：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-java" data-lang="java">String title = article.<span style="color:#658b00">title</span> == <span style="color:#8b008b;font-weight:bold">null</span> ? <span style="color:#cd5555">&#34;未命名&#34;</span> : article.<span style="color:#658b00">title</span>;
</code></pre></div><p>在Kotlin中没有三元运算符了，但if和when语句可以有返回值了。于是可以写作</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#8b008b;font-weight:bold">var</span> title = <span style="color:#8b008b;font-weight:bold">if</span> (article.title == <span style="color:#8b008b;font-weight:bold">null</span>) <span style="color:#cd5555">&#34;未命名&#34;</span> <span style="color:#8b008b;font-weight:bold">else</span> article.title
</code></pre></div><p>不过还有更简单的表达方法：</p>
<div class="highlight"><pre style="background-color:#eed;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-kt" data-lang="kt"><span style="color:#8b008b;font-weight:bold">var</span> title = article.title ?: <span style="color:#cd5555">&#34;未命名&#34;</span>
</code></pre></div><h3 id="操作符">!!操作符</h3>
<p>终于说到我翻车的地方了。<code>!!</code>操作符表示“我保证这个变量不为空，否则就抛出NPE吧！”。尽管变量可能的确不会为空，两个感叹号上去IDE就不报错了……</p>
<p>这是很不好的，所有Kotlin的书都告诉你要少用这个符号。这从这个符号的设计就看出来了，写起来就像在对编译器咆哮“我知道自己在做什么！！”。</p>
<section class="footnotes" role="doc-endnotes">
<hr>
<ol>
<li id="fn:1" role="doc-endnote">
<p><a href="https://www.kotlincn.net/docs/reference/null-safety.html">空安全 - Kotlin 语言中文站</a> <a href="#fnref:1" class="footnote-backref" role="doc-backlink">&#x21a9;&#xfe0e;</a></p>
</li>
</ol>
</section>

                    
                    <HR width="100%" id="EOF">
		    <p style="color:#777;">最后修改于 2020-12-15</p>
                    
                </div>
            </div>
            
            
            <nav class="post-pagination">

                
                <a class="newer-posts" href="https://ntutn.top/posts/activity/">
			下回<br>android项目开发：Activity
                </a>
                
                
                
                <a class="older-posts" href="https://ntutn.top/posts/b%E7%AB%99%E7%9A%84%E6%90%AC%E8%BF%90%E6%9C%BA%E5%88%B6%E5%92%8C%E7%9B%97%E8%A7%86%E9%A2%91%E8%A1%8C%E4%B8%BA%E6%9C%89%E5%8C%BA%E5%88%AB%E5%90%97/">
			上回<br>B站的搬运机制和盗视频行为有区别吗
                </a>
                
            </nav>
            <div class="post-comment-wrapper">
                










<script src="https://utteranc.es/client.js"
        repo="zerofancy/zerofancy.github.io"
        issue-term="title"
        label=""
        theme="github-light"
        crossorigin="anonymous"
        async>
</script>

            </div>
        </div>
    </div>


                    </div>
            </div><div id="single-column-footer">
Hugo Theme <a href="https://github.com/amazingrise/hugo-theme-diary">Diary</a> by <a href="https://risehere.net/">Rise</a>
<br>
移植自 <a href="https://mak1t0.cc/" target="_blank" rel="noreferrer noopener">Makito</a>'s <a href="https://github.com/SumiMakito/hexo-theme-journal/" target="_blank" rel="noreferrer noopener">Journal.</a> <br>
<br>

&copy;
	
	CC BY-SA 4.0
	
</div>
            </div>
    
    <script src="/js/journal.js"></script>
    </body>
</html>
