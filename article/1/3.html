<!doctype html>
<html lang="zh-CN">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/styles/idea.min.css"
        integrity="sha512-Rfc5zQIp95eozfMCdS3B4MItUxU8orNje/t1OEhf7XwIk0DTCuMH2LG0NIgP8UGYK9L39WfUNI1c4IsM5yY/PA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <title>数据结构 栈应用2 表达式求值-归零幻想</title>

    <style>
        body {
            background-repeat: no-repeat;
            background-attachment: fixed;
        }
    </style>
</head>

<body>
    <nav class="container navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/favicon.ico" alt="归零幻想" width="20px" height="20px">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/tag.html">标签</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/about">关于</a>
                    </li>
                    <!--
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Dropdown
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                    </li>
                -->
                </ul>
                <!--
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
                -->
            </div>
        </div>
    </nav>

    <div class="container mt-3">
        <div class="row">
            <div class="card col" id="content-container">
                <div class="card-body"><blockquote>
<p>表达式求值是程序设计语言编译中的一个最基本问题，它的实现是栈应用的一个典型例子。</p>
</blockquote>
<h2 id="question">Question</h2>
<p>表达式求值是进行数据处理的最基本操作。请编写程序完成一个简单算术表达式的求值。要求如下：</p>
<ol>
<li>运算符包括：<code>+、-、*、-、^(乘方)、括号</code></li>
<li>运算量为数值常量，根据自己的能力可以对运算量做不同的约束，例如1位整数、多位整数、实数等（会有不同的测试用例）；</li>
</ol>
<!--summary-->
<ul>
<li>输入：一行，即表达式，以“=”结束。例如：</li>
</ul>
<pre><code>5*(8-3)+6/5=
</code></pre>
<ul>
<li>输出：一行，即表达式的值。结果值为整数时输出为整数，如果有小数时保留5位小数。</li>
</ul>
<pre><code>26.20000
</code></pre>
<h2 id="问题与分析">问题与分析</h2>
<h3 id="栈">栈</h3>
<p>栈是特殊的线性表，其一端固定，只允许在另一端插入或删除。其特性是“先进后出”。</p>
<h3 id="表达式的书写形式">表达式的书写形式</h3>
<ul>
<li>前缀式 <code>+ × a b × - c / d e f</code></li>
<li>中缀式 <code>a × b + (c - d / e) × f</code></li>
<li>后缀式 <code>a b × c d e / - f × +</code></li>
</ul>
<h4 id="前缀式的运算规则">前缀式的运算规则</h4>
<p>连续出现的两个操作数和在它们之前且紧靠它们的运算符构成一个最小表达式;</p>
<p>运算符出现的顺序与运算顺序相反</p>
<blockquote>
<p>中缀式与后缀式略。其中中缀式是我们最常书写的形式。</p>
</blockquote>
<h3 id="后缀式的运算">后缀式的运算</h3>
<ul>
<li>是操作数，入栈</li>
<li>是符号，取出两个操作数运算后入栈</li>
<li>表达式处理完毕后栈内唯一元素即运算结果</li>
</ul>
<h3 id="中缀式转换为后缀式">中缀式转换为后缀式</h3>
<p><img src="/res/img/stack1.png" alt="优先级顺序处理" /></p>
<p><img src="/res/img/stack2.png" alt="表达式求值流程" /></p>
<h3 id="直接对中缀式求值">直接对中缀式求值</h3>
<p>类似中缀式转后缀式的过程，把运算量的输出改为“入OPND栈”，把运算符的“输出”改为“计算”：根据运算符，出栈需要的运算量，计算值，结果作为运算量再入栈。其他不需要变化。</p>
<h3 id="遇到的其他问题">遇到的其他问题</h3>
<ol>
<li>用float交这道题会出错，精度不够，要用double。</li>
<li>判断有没有小数的方法：截断后与原值相减绝对值在误差允许范围内。不能用相等，因为浮点数的存储性质，直接比较相等很可能出错。</li>
<li>通过<code>cin</code>的<code>setiosflags</code>和<code>setprecision</code>格式化提交也会有问题，因为这样竟然是进行四舍五入的……</li>
</ol>
<h2 id="answer">Answer</h2>
<pre><code class="language-cpp">#include &lt;iostream&gt;
#include &lt;string&gt;
#include &lt;sstream&gt;
#include &lt;cmath&gt;
#include &lt;iomanip&gt;
#include &lt;cstdio&gt;

using namespace std;

template &lt;class T&gt;
class mystack{
private:
    T *data;
    int maxsize;
    int top;
public:
    mystack(){
        maxsize=1;
        data=new T[maxsize];
        top=-1;
    }

    bool isEmpty(){
        return top==-1;
    }

    T getTop(){
        if(top&gt;-1){
            return data[top];
        }
        return NULL;
    }

    void pop(){
        if(top&gt;=0){
            top--;
        }
    }

    void expand(){
        T*tmp=new T[maxsize*2];
        for(int i=0;i&lt;maxsize;i++){
            tmp[i]=data[i];
        }
        maxsize*=2;
        delete[] data;
        data=tmp;
    }

    void push(T x){
        if(top+1==maxsize){
            expand();
        }
        data[++top]=x;
    }

    ~mystack(){
        delete[] data;
    }
};

int getid(char x){
    string str=&quot;+-*/^()#&quot;;
    for(int i=0;i&lt;str.size();i++){
        if(x==str.at(i)){
            return i;
        }
    }
    return -1;
}
/**
* 栈外符号大于栈内，返回1，小于返回-1，其他返回0
* @param ch1 栈内的符号
* @param ch2 栈外的符号
*/
int cmpp(char ch1,char ch2){
    string chart[]={
        //+-*/^()#
        &quot;&gt;&gt;&lt;&lt;&lt;&lt;&gt;&gt;&quot;,//+
        &quot;&gt;&gt;&lt;&lt;&lt;&lt;&gt;&gt;&quot;,//-
        &quot;&gt;&gt;&gt;&gt;&lt;&lt;&gt;&gt;&quot;,//*
        &quot;&gt;&gt;&gt;&gt;&lt;&lt;&gt;&gt;&quot;,///
        &quot;&gt;&gt;&gt;&gt;&gt;&lt;&gt;&gt;&quot;,//^
        &quot;&lt;&lt;&lt;&lt;&lt;&lt;=X&quot;,//(
        &quot;&gt;&gt;&gt;&gt;&gt;X&gt;&gt;&quot;,//)
        &quot;&lt;&lt;&lt;&lt;&lt;&lt;X=&quot;//#
        };
    if(chart[ch1].at(ch2)=='&lt;'){
        return 1;
    }else if(chart[ch1].at(ch2)=='&gt;'){
        return -1;
    }
    return 0;
}

template &lt;class Type&gt;
Type stringToNum(const string&amp; str)
{
	istringstream iss(str);
	Type num;
	iss &gt;&gt; num;
	return num;
}
double cal(string str){
    mystack&lt;char&gt;* OPTR=new mystack&lt;char&gt;();
    mystack&lt;double&gt;* OPND=new mystack&lt;double&gt;();
    OPTR-&gt;push('#');
    string buf=&quot;&quot;;//数值缓冲，使数值作为整体处理
    double res;//返回结果
    for(int i=1;i&lt;str.size();i++){
        char x=str.at(i);
        if(getid(x)==-1){
            buf+=x;
        }else{
            if(buf.size()&gt;0){
                OPND-&gt;push(stringToNum&lt;double&gt;(buf));
                buf=&quot;&quot;;
            }
            switch(cmpp(getid(OPTR-&gt;getTop()),getid(x))){
            case 1:
                OPTR-&gt;push(x);
                continue;
            case -1:
                //计算
                double tmp1,tmp2,tmp;
                tmp2=OPND-&gt;getTop();
                OPND-&gt;pop();
                tmp1=OPND-&gt;getTop();
                OPND-&gt;pop();
                switch(OPTR-&gt;getTop()){
                case '+':
                    tmp=tmp1+tmp2;
                    break;
                case '-':
                    tmp=tmp1-tmp2;
                    break;
                case '*':
                    tmp=tmp1*tmp2;
                    break;
                case '/':
                    tmp=tmp1/tmp2;
                    //可以进行除数为0的判断
                    break;
                case '^':
                    tmp=pow(tmp1,tmp2);
                    break;
                }
                OPND-&gt;push(tmp);
                OPTR-&gt;pop();
                i--;
                continue;
            case 0:
                OPTR-&gt;pop();
                continue;
            }
        }
    }
    res=OPND-&gt;getTop();
    delete OPTR;
    delete OPND;
    return res;
}

int main()
{
    string str;
    getline(cin,str);
    str=&quot;#&quot;+str;
    str.erase(str.size()-1);
    str+=&quot;#&quot;;
    double res=cal(str);
    if(abs(double(int(res))-res)&lt;0.000001){
        cout&lt;&lt;res&lt;&lt;endl;
    }else{
        cout&lt;&lt;setiosflags(ios::fixed)&lt;&lt;setprecision(5)&lt;&lt;int(1e5*res)/1e5&lt;&lt;endl;
    }
    return 0;
}

</code></pre>
</div>
            </div>

            <div class="card col-md-4 d-none d-md-block ms-md-3 text-center">
                <div class="sticky-top">
                    <img src="/favicon.ico" alt="avatar" class="mt-3">
                    <div class="card-body">
                        <p class="card-text">
                            归零幻想
                        </p>
                        <p class="card-text">
                            邮件：<a href="mailto:admin@ntutn.top">admin@ntutn.top</a><br>
                            Telegram: <a href="https://t.me/zerofancy">@zerofancy</a>
                        </p>
                        <blockquote id="hitokoto">正在追番《艾克斯奥特曼》。</blockquote>
                        <div style="text-align:right;" id="hitokoto_from">——站长</div>
                        <a href="/atom.xml">RSS</a>
                    </div>
                    <div>
                        <p class="card-body">友情链接</p>
                        <ul>
                            <li><a href="https://blog.semesse.me/">色魔是色魔</a></li>
                            <li><a href="http://www.xyx6.top/">XYX</a></li>
                            <li><a href="http://upccaishu.top/">菜树</a></li>
                            <li><a href="https://www.ruiovo.top/">ruiOvO</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 一言
        let xhr = new XMLHttpRequest()
        xhr.open('get', 'https://v1.hitokoto.cn/')
        xhr.send()
        xhr.onload = function () {
            let hitokotoResult = JSON.parse(xhr.responseText)
            document.getElementById("hitokoto").innerText = hitokotoResult.hitokoto
            document.getElementById("hitokoto_from").innerText = "——" + hitokotoResult.from
        }
        // 页码
        var getRandomColor = function () {
            return '#' +
                (function (color) {
                    return (color += '0123456789abcdef'[Math.floor(Math.random() * 16)]) && (color.length == 6) ? color : arguments.callee(color);
                })('');
        }
        let pageWidth = window.innerWidth,
            pageHeight = window.innerHeight
        if (typeof innerWidth != 'number') {
            if (document.compatMode == 'CSS1Compat') {//严格模式
                pageWidth = document.documentElement.clientWidth
                pageHeight = document.documentElement.clientHeight
            } else {
                pageWidth = document.body.clientWidth
                pageHeight = document.body.clientHeight
            }
        }
        document.body.style.backgroundColor = getRandomColor();
        console.log(`https://source.unsplash.com/random/${pageWidth}x${pageHeight}`)
        document.body.style.backgroundImage = `url(https://source.unsplash.com/random/${pageWidth}x${pageHeight})`;
    </script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/highlight.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/bash.min.js"
        integrity="sha512-HIFqAH4BgdlJE3A1Uoyl6weoDR1WtdufmKBPWtemvTI+12lrV5dfPR5ekvJaePkq6w+zuPAek2X2hHxo/T5kag=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/basic.min.js"
        integrity="sha512-8MrrYyqbmwVrcDGR/2VenE2+IX+ELHJxM0vysdjlAQrJyXZwfKl9dXdyWASFBKzuszu8z3G7XoyjeJVM3b9MlQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/c.min.js"
        integrity="sha512-+2nEdmDIEQVBw4y3LD2BLOgAvX1+xx9kPQawjQB/HNfi4bDgSF4ywg8yIQ67ijrLLO2ruHaX9dZ25ruG3HwZSg=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/cpp.min.js"
        integrity="sha512-OsjySiIaNsR3uFe7uEH6yht3is/WrIXKocWeO0YHFs25jOwHwMtzIdkUENQjblQihTUIN78bpnLKbhMxRegjLw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/gradle.min.js"
        integrity="sha512-QXYGxsyYg6bKlr3W82K2fp25xklKskdnms2qEhgrm2Uz+dnDG3RCHmVP6GQ6waI34+lirlcgsdddvmSXbBhhhQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/groovy.min.js"
        integrity="sha512-wHPb/EJ15Z5bl59kfxL/THnrtIGdrlOD0CdeBKZ1tsgcLsmx4kbiTmB0gsPZUqCzgIB3MK9tBemnrIr41WFUkQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/java.min.js"
        integrity="sha512-5j3t2T2xf236N+J+QPE2Po6Q3P/SXze0hgt2XMi1mbYzkC2VqeB/DFYICXfMhV1V+KdxDOBp9PcCAebb8kLvSw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/javascript.min.js"
        integrity="sha512-Jvh5kXa0Zu4HoSxPaZIVhCWPkD7b7gnWHVzv6jiaJwAJ18a/U6BOXludYfJYwHorpy2WFH0Df6EcFi5udu1dWA=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/json.min.js"
        integrity="sha512-z3sCqG8cfRJGXv+x7QvVAx92uACSYScuJCRQzSjEhAU23TabHD8+tqafvAbKterqaB4tkiVJYCFNhQaT1+QmfQ=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/kotlin.min.js"
        integrity="sha512-ZEBRAqmcLuQ5A9KdZIayen2HuDMAau0Q4C3s/gwnIldFSvOxAOXJk0zhEpu30ACABYAmHKNSZDmup5OEGbx+9g=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.3.1/languages/xml.min.js"
        integrity="sha512-1UdiK7+k2GhyGJMG9hmQXQ51TP2NPjHjh65uWhCeqSXSZ4UlzDG5+/st9VWRksKWYxKeU37/qwSAuPfSkcWD6A=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        hljs.highlightAll()
    </script>

    <!--图片调整-->
    <script>
        //获取图片元素
        var imgs = document.getElementsByTagName("img");
        //获取div元素   
        var contentLeft = document.getElementById("content-container");
        //使用js设置图片元素宽度的变化    
        for (var i = 0; i < imgs.length; i++) {
            imgs[i].style["max-width"] = contentLeft.offsetWidth - 60 + "px";
        }
        //40是要减去padding
    </script>

    <!--HTTPS重定向-->
    <script>
        if (!(window.location.host.startsWith("127.0.0.1") || window.location.host.startsWith("localhost")) && (window.location.protocol != "https:")) {
            window.location.protocol = "https";
        }
    </script>
</body>

</html>