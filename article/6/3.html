<!doctype html>
<html lang="zh-CN">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
    <title>Hello, world!</title>
</head>

<body>
    <nav class="container navbar navbar-expand-lg navbar-light bg-light">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <img src="/favicon.ico" alt="归零幻想" width="20px" height="20px">
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false"
                aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link active" aria-current="page" href="/">Home</a>
                    </li>
                <!--
                    <li class="nav-item">
                        <a class="nav-link" href="#">Link</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button"
                            data-bs-toggle="dropdown" aria-expanded="false">
                            Dropdown
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li>
                                <hr class="dropdown-divider">
                            </li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link disabled" href="#" tabindex="-1" aria-disabled="true">Disabled</a>
                    </li>
                -->
                </ul>
                <!--
                <form class="d-flex">
                    <input class="form-control me-2" type="search" placeholder="Search" aria-label="Search">
                    <button class="btn btn-outline-success" type="submit">Search</button>
                </form>
                -->
            </div>
        </div>
    </nav>

    <div class="container mt-3">
        <div class="row">
            <div class="card col-md-4 d-none d-md-block me-md-3 text-center" style="width: 18rem;">
                <img src="/favicon.ico" alt="avatar" class="mt-3">
                <div class="card-body">
                    <p class="card-text">
                        归零幻想
                    </p>
                </div>
            </div>
    
            <div class="card col">
                <div class="card-body"><p>新建一个安卓项目，<code>Android Studio</code>已经为我们生成的模板中，<code>build.gradle</code>总是很显眼。我也终于下定决心来了解下这个构建整合工具。</p>
<p>gradle脚本使用<code>groovy</code>编写，最近也开始支持用<code>Kotlin</code>编写。Kotlin大法好，但我暂时只找到了groovy的教程<sup id="fnref-3"><a class="footnote-ref" href="#fn-3">3</a></sup>，暂时不想去啃英文，先将就学着。</p>
<h2 id="gradle安装">gradle安装</h2>
<h3 id="命令">命令</h3>
<p>对于OSX用户来说，<code>brew install gradle</code>就可以搞定这个步骤了。但是这里有个问题，就是这样会把openjdk当做依赖装上。也不算很大的问题，也能将就用。</p>
<h3 id="gradle-wrapper">gradle wrapper</h3>
<p>gradle有一个很方便的命令，<code>gradle wrapper</code>，使用后会创建如下的目录结构</p>
<pre><code>.
├── build.gradle
├── gradle
│   └── wrapper
│       ├── gradle-wrapper.jar
│       └── gradle-wrapper.properties
├── gradlew
└── gradlew.bat
</code></pre>
<p>此时即使你没有安装gradle，仍然可以使用<code>./gradlew</code>代替<code>gradle</code>执行命令。如<code>./gradlew clean install</code>。在实际的项目中，这种方式使用比较普遍，因为gradle脚本很多特性受版本影响比较大，一般gradle的版本也会在项目中指定。</p>
<!--summary-->
<h2 id="task">task</h2>
<h3 id="基本使用">基本使用</h3>
<p>task即构建任务，一个最简单的构建任务如下</p>
<pre><code class="language-groovy">task hello {
    doLast {
        println 'Hello world!'
    }
}
</code></pre>
<p>此时输入<code>gradle -q hello</code>就可以看到输出了。<code>-q</code>指<code>quiet</code>，会忽略一些gradle自身的输出。</p>
<blockquote>
<p>教程中还写了一种更简洁的写法<sup id="fnref-1"><a class="footnote-ref" href="#fn-1">1</a></sup>，但我发现这种写法已经被废弃<sup id="fnref-2"><a class="footnote-ref" href="#fn-2">2</a></sup>，不再写出。</p>
</blockquote>
<h3 id="任务依赖">任务依赖</h3>
<p>声明任务间的依赖关系。</p>
<pre><code class="language-groovy">task taskY {
	doLast {
		println 'taskY'
	}
}
task taskX(dependsOn: taskY) {
	doLast {
		println 'taskX'
	}
}
</code></pre>
<p>或</p>
<pre><code class="language-groovy">task taskX(dependsOn: 'taskY') { //因为taskY还未定义，只能这样使用
	doLast {
		println 'taskX'
	}
}
task taskY {
	doLast {
		println 'taskY'
	}
}
</code></pre>
<pre><code>➜  task gradle -q taskX
taskY
taskX
➜  task
</code></pre>
<h3 id="动态任务">动态任务</h3>
<p>可以动态创建任务，使用已经存在的任务。</p>
<pre><code class="language-groovy">4.times { counter -&gt;
    task &quot;task$counter&quot; {
		doLast{
			println &quot;I'm task number $counter&quot;
		}
	}
}
task0.dependsOn task2, task3
</code></pre>
<pre><code>➜  task gradle -q task0
I'm task number 2
I'm task number 3
I'm task number 0
➜  task 
</code></pre>
<h3 id="自定义属性">自定义属性</h3>
<p>自定义属性和默认任务</p>
<pre><code class="language-groovy">defaultTasks 'information','hello'

task information {
	doLast {
		println 'I use this script to learn gradle.'
	}
}

task hello {
	ext {
		computer = 'IF'
		user = 'Haidee'
	}

	doLast {
		println 'Hello Susan'
	}	
	
	doFirst {
		println 'Hello Zero'
	}

	doLast {
		println &quot;There are also $hello.computer and $hello.user in our organization.&quot;
	}
}
</code></pre>
<pre><code>➜  task gradle -q
I use this script to learn gradle.
Hello Zero
Hello Susan
There are also IF and Haidee in our organization.
➜  task 
</code></pre>
<h3 id="判断发布任务是否在要被执行的任务中">判断发布任务是否在要被执行的任务中</h3>
<pre><code class="language-groovy">task distribution &lt;&lt; {
    println &quot;We build the zip with version=$version&quot;
}

task release(dependsOn: 'distribution') &lt;&lt; {
    println 'We release now'
}

gradle.taskGraph.whenReady {taskGraph -&gt;
    if (taskGraph.hasTask(release)) {
        version = '1.0'
    } else {
        version = '1.0-SNAPSHOT'
    }
}
</code></pre>
<pre><code>➜  task gradle -q distribution
We build the zip with version=1.0-SNAPSHOT
➜  task gradle -q release
We build the zip with version=1.0
We release now
➜  task 
</code></pre>
<blockquote>
<p>使用<code>gradle tasks --all</code>可以列出当前项目所有构建任务。</p>
</blockquote>
<h2 id="java构建">java构建</h2>
<h3 id="基础java项目">基础java项目</h3>
<pre><code class="language-sh">mkdir javaproject
cd javaproject
mkdir -p src/main/java
mkdir -p src/test/java
echo &quot;apply plugin: 'java'&quot; &gt; build.gradle
</code></pre>
<pre><code>.
├── build.gradle
└── src
    ├── main
    │   └── java
    └── test
        └── java

5 directories, 1 file
</code></pre>
<h4 id="添加依赖">添加依赖</h4>
<pre><code class="language-groovy">repositories {
    mavenCentral()
}

dependencies {
    implementation group: 'commons-collections', name: 'commons-collections', version: '3.2'
    testImplementation group: 'junit', name: 'junit', version: '4.+'
}
</code></pre>
<h4 id="定制-manifestmf-文件">定制 MANIFEST.MF 文件</h4>
<pre><code class="language-groovy">sourceCompatibility = 1.8
version = '1.0'

jar {
    manifest {
        attributes 'Implementation-Title': 'Gradle Quickstart', 'Implementation-Version': version
    }
}
</code></pre>
<h4 id="发布jar文件">发布jar文件</h4>
<pre><code class="language-groovy">uploadArchives {
    repositories {
       flatDir {
           dirs 'repos'
       }
    }
}
</code></pre>
<h3 id="多项目java构建">多项目java构建</h3>
<pre><code class="language-sh">mkdir multiproject
cd multiproject
mkdir api
mkdir -p services/webservice
mkdir shared
</code></pre>
<h4 id="项目结构">项目结构</h4>
<pre><code>.
├── api
│   ├── build
│   └── build.gradle
├── build.gradle
├── services
│   └── webservice
│       └── build.gradle
├── settings.gradle
└── shared
    └── build.gradle
</code></pre>
<p><code>settings.gradle</code>指定要包括哪个项目。</p>
<pre><code class="language-groovy">include &quot;shared&quot;, &quot;api&quot;, &quot;services:webservice&quot;, &quot;services:shared&quot;
</code></pre>
<h4 id="通用配置">通用配置</h4>
<p>根项目的<code>build.gradle</code>中</p>
<pre><code class="language-groovy">subprojects {
    apply plugin: 'java'

    repositories {
        mavenCentral()
    }

    dependencies {
        testImplementation 'junit:junit:4.11'
    }

    version = '1.0'

    jar {
        manifest.attributes provider: 'gradle'
    }
}
</code></pre>
<h4 id="项目之间的依赖">项目之间的依赖</h4>
<p>api/build.gradle</p>
<pre><code class="language-groovy">dependencies {
    compile project(':shared')
}
</code></pre>
<h2 id="依赖管理基础知识">依赖管理基础知识</h2>
<blockquote>
<p>依赖类型，待整理，当前找到的资料有点乱。</p>
</blockquote>
<p>引用外部依赖需要<code>group</code>、<code>name</code>和<code>version</code>属性。</p>
<p>仓库（未完全验证）。</p>
<pre><code class="language-groovy">repositories {
    mavenCentral()
    maven {
        url &quot;http://repo.mycompany.com/maven2&quot;
    }
    ivy {
        url &quot;http://repo.mycompany.com/repo&quot;
    }
    ivy {
        // URL can refer to a local directory
        url &quot;../local-repo&quot;
    }
}
</code></pre>
<h2 id="groovy快速入门">groovy快速入门</h2>
<p>就一个例子，入门入了个寂寞。</p>
<pre><code class="language-groovy">apply plugin: 'groovy'

repositories {
    mavenCentral()
}

dependencies {
    implementation 'org.codehaus.groovy:groovy-all:2.3.3'
    testImplementation 'junit:junit:4.11'
}
</code></pre>
<h2 id="编写构建脚本">编写构建脚本</h2>
<h3 id="标准项目属性">标准项目属性</h3>
<p>project对象提供了一些标准属性，可以在对象中很方便地使用。</p>
<table>
<thead>
<tr><th>Name</th><th>Type</th><th>Default Value</th></tr>
</thead>
<tbody>
<tr><td>project</td><td>Project</td><td>Project 实例对象</td></tr>
<tr><td>name</td><td>String</td><td>项目目录的名称</td></tr>
<tr><td>path</td><td>String</td><td>项目的绝对路径</td></tr>
<tr><td>description</td><td>String</td><td>项目描述</td></tr>
<tr><td>projectDir</td><td>File</td><td>包含构建脚本的目录</td></tr>
<tr><td>build</td><td>File</td><td>projectDir/build</td></tr>
<tr><td>group</td><td>Object</td><td>未具体说明</td></tr>
<tr><td>version</td><td>Object</td><td>未具体说明</td></tr>
<tr><td>ant</td><td>AntBuilder</td><td>Ant实例对象</td></tr>
</tbody>
</table>
<blockquote>
<p>来自Gradle User Guide<sup id="fnref-3-1"><a class="footnote-ref" href="#fn-3">3</a></sup>，未验证。</p>
</blockquote>
<h3 id="变量">变量</h3>
<p>声明变量</p>
<pre><code class="language-groovy">def dest = &quot;dest&quot;
</code></pre>
<p>拓展属性</p>
<pre><code class="language-groovy">ext {
    springVersion = &quot;3.1.0.RELEASE&quot;
    emailNotification = &quot;build@master.org&quot;
}
</code></pre>
<h3 id="方法">方法</h3>
<p>圆括号可选。</p>
<div class="footnotes">
<hr />
<ol>
<li id="fn-1">
<p><a href="https://wiki.jikexueyuan.com/project/GradleUserGuide-Wiki/build_script_basics/a_shortcut_task_definition.html">https://wiki.jikexueyuan.com/project/GradleUserGuide-Wiki/build_script_basics/a_shortcut_task_definition.html</a></p>
<a href="#fnref-1" class="footnote-backref">&#8617;</a>
</li>
<li id="fn-2">
<p><a href="https://www.cnblogs.com/yuanchaoyong/p/11421595.html">https://www.cnblogs.com/yuanchaoyong/p/11421595.html</a></p>
<a href="#fnref-2" class="footnote-backref">&#8617;</a>
</li>
<li id="fn-3">
<p><a href="https://wiki.jikexueyuan.com/project/GradleUserGuide-Wiki/">Gradle User Guide 中文版</a></p>
<a href="#fnref-3" class="footnote-backref">&#8617;</a>
<a href="#fnref-3-1" class="footnote-backref">&#8617;</a>
</li>
</ol>
</div>
</div>
            </div>
    
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
</body>

</html>